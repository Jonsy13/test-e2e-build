{"ast":null,"code":"import _objectSpread from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useMutation,useQuery}from'@apollo/client';import{IconButton,Paper,Table,TableBody,TableCell,TableContainer,TableHead,TablePagination,TableRow,Typography}from'@material-ui/core';import moment from'moment';import React,{useState}from'react';import{useTranslation}from'react-i18next';import Loader from'../../../components/Loader';import{DELETE_CLUSTER,GET_CLUSTER}from'../../../graphql';import{getProjectID}from'../../../utils/getSearchParams';import{sortAlphaAsc,sortAlphaDesc,sortNumAsc,sortNumDesc}from'../../../utils/sort';import HeaderSection from'./HeaderSection';import useStyles from'./styles';import TableData from'./TableData';var BrowseCluster=function BrowseCluster(){var _filteredData$length;var classes=useStyles();var projectID=getProjectID();var _useState=useState({search:'',status:'All',cluster:'All'}),_useState2=_slicedToArray(_useState,2),filters=_useState2[0],setFilters=_useState2[1];var _useQuery=useQuery(GET_CLUSTER,{variables:{project_id:projectID},fetchPolicy:'cache-and-network',pollInterval:3000}),data=_useQuery.data,loading=_useQuery.loading,error=_useQuery.error;// Apollo mutation to delete the selected Target Cluster\nvar _useMutation=useMutation(DELETE_CLUSTER),_useMutation2=_slicedToArray(_useMutation,1),deleteCluster=_useMutation2[0];var _React$useState=React.useState({dateValue:'Select a period',fromDate:new Date(0).toString(),toDate:new Date(new Date().setHours(23,59,59)).toString()}),_React$useState2=_slicedToArray(_React$useState,2),dateRange=_React$useState2[0],setDateRange=_React$useState2[1];var _useState3=useState({name:{sort:false,ascending:true},lastRun:{sort:true,ascending:true}}),_useState4=_slicedToArray(_useState3,2),sortData=_useState4[0],setSortData=_useState4[1];var filteredData=data===null||data===void 0?void 0:data.getCluster.filter(function(dataRow){return dataRow.cluster_name.toLowerCase().includes(filters.search.toLowerCase());}).filter(function(dataRow){if(filters.status==='All'){return true;}if(!dataRow.is_cluster_confirmed){var p='pending';return p.includes(filters.status.toLowerCase());}return dataRow.is_active.toString().toLowerCase().includes(filters.status.toLowerCase());}).filter(function(dataRow){return filters.cluster==='All'?true:dataRow.cluster_type.toLowerCase().includes(filters.cluster.toLowerCase());}).filter(function(dataRow){return dateRange.fromDate&&dateRange.toDate===undefined?true:parseInt(dataRow.updated_at,10)*1000>=new Date(moment(dateRange.fromDate).format()).getTime()&&parseInt(dataRow.updated_at,10)*1000<=new Date(moment(dateRange.toDate).format()).getTime();}).sort(function(a,b){// Sorting based on unique fields\nif(sortData.name.sort){var x=a.cluster_name;var y=b.cluster_name;return sortData.name.ascending?sortAlphaAsc(x,y):sortAlphaDesc(x,y);}if(sortData.lastRun.sort){var _x=parseInt(a.created_at,10);var _y=parseInt(b.created_at,10);return sortData.lastRun.ascending?sortNumAsc(_y,_x):sortNumDesc(_y,_x);}return 0;});var _useState5=useState({pageNo:0,rowsPerPage:5}),_useState6=_slicedToArray(_useState5,2),paginationData=_useState6[0],setPaginationData=_useState6[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),popAnchorEl=_React$useState4[0],setPopAnchorEl=_React$useState4[1];var isOpen=Boolean(popAnchorEl);var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),open=_React$useState6[0],setOpen=_React$useState6[1];var handlePopOverClose=function handlePopOverClose(){setPopAnchorEl(null);setOpen(false);};var handlePopOverClick=function handlePopOverClick(event){setPopAnchorEl(event.currentTarget);setOpen(true);};// Functions passed as props in the headerSeaction\nvar changeSearch=function changeSearch(event){setFilters(_objectSpread(_objectSpread({},filters),{},{search:event.target.value}));};var changeStatus=function changeStatus(event){setFilters(_objectSpread(_objectSpread({},filters),{},{status:event.target.value}));};var changeCluster=function changeCluster(event){setFilters(_objectSpread(_objectSpread({},filters),{},{cluster:event.target.value}));};var dateChange=function dateChange(selectFromDate,selectToDate){setDateRange({dateValue:\"\".concat(moment(selectFromDate).format('DD.MM.YYYY').toString(),\"-\").concat(moment(selectToDate).format('DD.MM.YYYY').toString()),fromDate:new Date(new Date(selectFromDate).setHours(0,0,0)).toString(),toDate:new Date(new Date(selectToDate).setHours(23,59,59)).toString()});};var _useTranslation=useTranslation(),t=_useTranslation.t;var deleteRow=function deleteRow(clid){deleteCluster({variables:{cluster_id:clid}});};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"section\",{className:\"Heading section\"},/*#__PURE__*/React.createElement(HeaderSection,{searchValue:filters.search,changeSearch:changeSearch,statusValue:filters.status,changeStatus:changeStatus,clusterValue:filters.cluster,changeCluster:changeCluster,popOverClick:handlePopOverClick,popOverClose:handlePopOverClose,isOpen:isOpen,popAnchorEl:popAnchorEl,isDateOpen:open,displayDate:dateRange.dateValue,selectDate:dateChange})),/*#__PURE__*/React.createElement(Paper,{className:classes.root},/*#__PURE__*/React.createElement(TableContainer,{className:classes.tableMain},/*#__PURE__*/React.createElement(Table,{stickyHeader:true,\"aria-label\":\"simple table\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,{className:classes.tableRows},/*#__PURE__*/React.createElement(TableCell,{className:classes.headerStatus},/*#__PURE__*/React.createElement(\"div\",{className:classes.tableCell},/*#__PURE__*/React.createElement(Typography,null,t('workflowCluster.header.formControl.tableStatus')),/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"sort in descending order\",size:\"small\",onClick:function onClick(){return setSortData(_objectSpread(_objectSpread({},sortData),{},{lastRun:{sort:true,ascending:false}}));}},/*#__PURE__*/React.createElement(\"div\",{className:classes.targetsIcon},/*#__PURE__*/React.createElement(\"img\",{src:\"/icons/arrow_downward.svg\",alt:\"ConnectTarget icon\"}))))),/*#__PURE__*/React.createElement(TableCell,{className:classes.workflowName},/*#__PURE__*/React.createElement(\"div\",{className:classes.tableCell},/*#__PURE__*/React.createElement(Typography,null,t('workflowCluster.header.formControl.tableCluster')),/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"sort in descending\",size:\"small\",onClick:function onClick(){return setSortData(_objectSpread(_objectSpread({},sortData),{},{name:{sort:true,ascending:false}}));}},/*#__PURE__*/React.createElement(\"div\",{className:classes.targetsIcon},/*#__PURE__*/React.createElement(\"img\",{src:\"/icons/arrow_downward.svg\",alt:\"ConnectTarget icon\"}))))),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Typography,{className:classes.targetCluster},t('workflowCluster.header.formControl.connectionDate'))),/*#__PURE__*/React.createElement(TableCell,{className:classes.headData},/*#__PURE__*/React.createElement(Typography,null,t('workflowCluster.header.formControl.noWorkflows'))),/*#__PURE__*/React.createElement(TableCell,{className:classes.headData},/*#__PURE__*/React.createElement(\"div\",{className:classes.tableCell},/*#__PURE__*/React.createElement(Typography,null,t('workflowCluster.header.formControl.noSchedules')))),/*#__PURE__*/React.createElement(TableCell,{className:classes.headData},/*#__PURE__*/React.createElement(\"div\",{className:classes.tableCell},/*#__PURE__*/React.createElement(Typography,null,t('workflowCluster.header.formControl.run')))),/*#__PURE__*/React.createElement(TableCell,{className:classes.headData},/*#__PURE__*/React.createElement(\"div\",{className:classes.tableCell},/*#__PURE__*/React.createElement(Typography,null,t('workflowCluster.header.formControl.disconnect')))))),/*#__PURE__*/React.createElement(TableBody,null,loading?/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{colSpan:7},/*#__PURE__*/React.createElement(Loader,null))):error?/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{\"data-cy\":\"browseClusterError\",colSpan:7},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},t('workflowCluster.header.formControl.fetchingError')))):filteredData?filteredData.slice(paginationData.pageNo*paginationData.rowsPerPage,paginationData.pageNo*paginationData.rowsPerPage+paginationData.rowsPerPage).map(function(data){return/*#__PURE__*/React.createElement(TableRow,{\"data-cy\":\"browseClusterData\",key:data.cluster_id,className:classes.dataRow},/*#__PURE__*/React.createElement(TableData,{data:data,deleteRow:deleteRow}));}):/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{\"data-cy\":\"browseClusterNoData\",colSpan:0},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},t('workflowCluster.header.formControl.recordAvailable'))))))),/*#__PURE__*/React.createElement(TablePagination,{rowsPerPageOptions:[5,10,25],component:\"div\",count:(_filteredData$length=filteredData===null||filteredData===void 0?void 0:filteredData.length)!==null&&_filteredData$length!==void 0?_filteredData$length:0,rowsPerPage:paginationData.rowsPerPage,page:paginationData.pageNo,onChangePage:function onChangePage(_,page){return setPaginationData(_objectSpread(_objectSpread({},paginationData),{},{pageNo:page}));},onChangeRowsPerPage:function onChangeRowsPerPage(event){setPaginationData(_objectSpread(_objectSpread({},paginationData),{},{pageNo:0,rowsPerPage:parseInt(event.target.value,10)}));}})));};export default BrowseCluster;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/Targets/BrowseCluster/index.tsx"],"names":["useMutation","useQuery","IconButton","Paper","Table","TableBody","TableCell","TableContainer","TableHead","TablePagination","TableRow","Typography","moment","React","useState","useTranslation","Loader","DELETE_CLUSTER","GET_CLUSTER","getProjectID","sortAlphaAsc","sortAlphaDesc","sortNumAsc","sortNumDesc","HeaderSection","useStyles","TableData","BrowseCluster","classes","projectID","search","status","cluster","filters","setFilters","variables","project_id","fetchPolicy","pollInterval","data","loading","error","deleteCluster","dateValue","fromDate","Date","toString","toDate","setHours","dateRange","setDateRange","name","sort","ascending","lastRun","sortData","setSortData","filteredData","getCluster","filter","dataRow","cluster_name","toLowerCase","includes","is_cluster_confirmed","p","is_active","cluster_type","undefined","parseInt","updated_at","format","getTime","a","b","x","y","created_at","pageNo","rowsPerPage","paginationData","setPaginationData","popAnchorEl","setPopAnchorEl","isOpen","Boolean","open","setOpen","handlePopOverClose","handlePopOverClick","event","currentTarget","changeSearch","target","value","changeStatus","changeCluster","dateChange","selectFromDate","selectToDate","t","deleteRow","clid","cluster_id","root","tableMain","tableRows","headerStatus","tableCell","targetsIcon","workflowName","targetCluster","headData","slice","map","length","_","page"],"mappings":"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","sourcesContent":["import { useMutation, useQuery } from '@apollo/client';\nimport {\n  IconButton,\n  Paper,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TablePagination,\n  TableRow,\n  Typography,\n} from '@material-ui/core';\nimport moment from 'moment';\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Loader from '../../../components/Loader';\nimport { DELETE_CLUSTER, GET_CLUSTER } from '../../../graphql';\nimport {\n  Cluster,\n  Clusters,\n  ClusterVars,\n  DeleteCluster,\n} from '../../../models/graphql/clusterData';\nimport { getProjectID } from '../../../utils/getSearchParams';\nimport {\n  sortAlphaAsc,\n  sortAlphaDesc,\n  sortNumAsc,\n  sortNumDesc,\n} from '../../../utils/sort';\nimport HeaderSection from './HeaderSection';\nimport useStyles from './styles';\nimport TableData from './TableData';\n\ninterface FilterOptions {\n  search: string;\n  status: string;\n  cluster: string;\n}\n\ninterface SortData {\n  name: { sort: boolean; ascending: boolean };\n  lastRun: { sort: boolean; ascending: boolean };\n}\n\ninterface DateData {\n  dateValue: string;\n  fromDate: string;\n  toDate: string;\n}\n\ninterface PaginationData {\n  pageNo: number;\n  rowsPerPage: number;\n}\n\nconst BrowseCluster: React.FC = () => {\n  const classes = useStyles();\n  const projectID = getProjectID();\n\n  const [filters, setFilters] = useState<FilterOptions>({\n    search: '',\n    status: 'All',\n    cluster: 'All',\n  });\n\n  const { data, loading, error } = useQuery<Clusters, ClusterVars>(\n    GET_CLUSTER,\n    {\n      variables: {\n        project_id: projectID,\n      },\n      fetchPolicy: 'cache-and-network',\n      pollInterval: 3000,\n    }\n  );\n\n  // Apollo mutation to delete the selected Target Cluster\n  const [deleteCluster] = useMutation<DeleteCluster>(DELETE_CLUSTER);\n\n  const [dateRange, setDateRange] = React.useState<DateData>({\n    dateValue: 'Select a period',\n    fromDate: new Date(0).toString(),\n    toDate: new Date(new Date().setHours(23, 59, 59)).toString(),\n  });\n\n  const [sortData, setSortData] = useState<SortData>({\n    name: { sort: false, ascending: true },\n    lastRun: { sort: true, ascending: true },\n  });\n\n  const filteredData = data?.getCluster\n    .filter((dataRow) =>\n      dataRow.cluster_name.toLowerCase().includes(filters.search.toLowerCase())\n    )\n    .filter((dataRow) => {\n      if (filters.status === 'All') {\n        return true;\n      }\n      if (!dataRow.is_cluster_confirmed) {\n        const p = 'pending';\n        return p.includes(filters.status.toLowerCase());\n      }\n      return dataRow.is_active\n        .toString()\n        .toLowerCase()\n        .includes(filters.status.toLowerCase());\n    })\n    .filter((dataRow) =>\n      filters.cluster === 'All'\n        ? true\n        : dataRow.cluster_type\n            .toLowerCase()\n            .includes(filters.cluster.toLowerCase())\n    )\n    .filter((dataRow) => {\n      return dateRange.fromDate && dateRange.toDate === undefined\n        ? true\n        : parseInt(dataRow.updated_at, 10) * 1000 >=\n            new Date(moment(dateRange.fromDate).format()).getTime() &&\n            parseInt(dataRow.updated_at, 10) * 1000 <=\n              new Date(moment(dateRange.toDate).format()).getTime();\n    })\n    .sort((a: Cluster, b: Cluster) => {\n      // Sorting based on unique fields\n      if (sortData.name.sort) {\n        const x = a.cluster_name;\n        const y = b.cluster_name;\n\n        return sortData.name.ascending\n          ? sortAlphaAsc(x, y)\n          : sortAlphaDesc(x, y);\n      }\n\n      if (sortData.lastRun.sort) {\n        const x = parseInt(a.created_at, 10);\n        const y = parseInt(b.created_at, 10);\n\n        return sortData.lastRun.ascending\n          ? sortNumAsc(y, x)\n          : sortNumDesc(y, x);\n      }\n\n      return 0;\n    });\n\n  const [paginationData, setPaginationData] = useState<PaginationData>({\n    pageNo: 0,\n    rowsPerPage: 5,\n  });\n\n  const [popAnchorEl, setPopAnchorEl] = React.useState<null | HTMLElement>(\n    null\n  );\n  const isOpen = Boolean(popAnchorEl);\n\n  const [open, setOpen] = React.useState<boolean>(false);\n\n  const handlePopOverClose = () => {\n    setPopAnchorEl(null);\n    setOpen(false);\n  };\n  const handlePopOverClick = (event: React.MouseEvent<HTMLElement>) => {\n    setPopAnchorEl(event.currentTarget);\n    setOpen(true);\n  };\n\n  // Functions passed as props in the headerSeaction\n  const changeSearch = (\n    event: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>\n  ) => {\n    setFilters({ ...filters, search: event.target.value as string });\n  };\n\n  const changeStatus = (\n    event: React.ChangeEvent<{\n      name?: string | undefined;\n      value: unknown;\n    }>\n  ) => {\n    setFilters({ ...filters, status: event.target.value as string });\n  };\n\n  const changeCluster = (\n    event: React.ChangeEvent<{\n      name?: string | undefined;\n      value: unknown;\n    }>\n  ) => {\n    setFilters({ ...filters, cluster: event.target.value as string });\n  };\n\n  const dateChange = (selectFromDate: string, selectToDate: string) => {\n    setDateRange({\n      dateValue: `${moment(selectFromDate)\n        .format('DD.MM.YYYY')\n        .toString()}-${moment(selectToDate).format('DD.MM.YYYY').toString()}`,\n      fromDate: new Date(new Date(selectFromDate).setHours(0, 0, 0)).toString(),\n      toDate: new Date(new Date(selectToDate).setHours(23, 59, 59)).toString(),\n    });\n  };\n  const { t } = useTranslation();\n\n  const deleteRow = (clid: string) => {\n    deleteCluster({\n      variables: { cluster_id: clid },\n    });\n  };\n\n  return (\n    <div>\n      <section className=\"Heading section\">\n        {/* Header Section */}\n        <HeaderSection\n          searchValue={filters.search}\n          changeSearch={changeSearch}\n          statusValue={filters.status}\n          changeStatus={changeStatus}\n          clusterValue={filters.cluster}\n          changeCluster={changeCluster}\n          popOverClick={handlePopOverClick}\n          popOverClose={handlePopOverClose}\n          isOpen={isOpen}\n          popAnchorEl={popAnchorEl}\n          isDateOpen={open}\n          displayDate={dateRange.dateValue}\n          selectDate={dateChange}\n        />\n      </section>\n      <Paper className={classes.root}>\n        <TableContainer className={classes.tableMain}>\n          <Table stickyHeader aria-label=\"simple table\">\n            <TableHead>\n              <TableRow className={classes.tableRows}>\n                {/* Status */}\n                <TableCell className={classes.headerStatus}>\n                  <div className={classes.tableCell}>\n                    <Typography>\n                      {t('workflowCluster.header.formControl.tableStatus')}\n                    </Typography>\n                    <IconButton\n                      aria-label=\"sort in descending order\"\n                      size=\"small\"\n                      onClick={() =>\n                        setSortData({\n                          ...sortData,\n                          lastRun: { sort: true, ascending: false },\n                        })\n                      }\n                    >\n                      <div className={classes.targetsIcon}>\n                        <img\n                          src=\"/icons/arrow_downward.svg\"\n                          alt=\"ConnectTarget icon\"\n                        />\n                      </div>\n                    </IconButton>\n                  </div>\n                </TableCell>\n                {/* Workflow Name */}\n                <TableCell className={classes.workflowName}>\n                  <div className={classes.tableCell}>\n                    <Typography>\n                      {t('workflowCluster.header.formControl.tableCluster')}\n                    </Typography>\n                    <IconButton\n                      aria-label=\"sort in descending\"\n                      size=\"small\"\n                      onClick={() =>\n                        setSortData({\n                          ...sortData,\n                          name: { sort: true, ascending: false },\n                        })\n                      }\n                    >\n                      <div className={classes.targetsIcon}>\n                        <img\n                          src=\"/icons/arrow_downward.svg\"\n                          alt=\"ConnectTarget icon\"\n                        />\n                      </div>\n                    </IconButton>\n                  </div>\n                </TableCell>\n                {/* Target Cluster */}\n                <TableCell>\n                  <Typography className={classes.targetCluster}>\n                    {t('workflowCluster.header.formControl.connectionDate')}\n                  </Typography>\n                </TableCell>\n\n                {/* No of Workflows */}\n                <TableCell className={classes.headData}>\n                  <Typography>\n                    {t('workflowCluster.header.formControl.noWorkflows')}\n                  </Typography>\n                </TableCell>\n\n                {/* No of Schedules */}\n                <TableCell className={classes.headData}>\n                  <div className={classes.tableCell}>\n                    <Typography>\n                      {t('workflowCluster.header.formControl.noSchedules')}\n                    </Typography>\n                  </div>\n                </TableCell>\n\n                {/* Last Run */}\n                <TableCell className={classes.headData}>\n                  <div className={classes.tableCell}>\n                    <Typography>\n                      {t('workflowCluster.header.formControl.run')}\n                    </Typography>\n                  </div>\n                </TableCell>\n\n                {/* Delete Cluster */}\n                <TableCell className={classes.headData}>\n                  <div className={classes.tableCell}>\n                    <Typography>\n                      {t('workflowCluster.header.formControl.disconnect')}\n                    </Typography>\n                  </div>\n                </TableCell>\n              </TableRow>\n            </TableHead>\n\n            {/* Body */}\n            <TableBody>\n              {loading ? (\n                <TableRow>\n                  <TableCell colSpan={7}>\n                    <Loader />\n                  </TableCell>\n                </TableRow>\n              ) : error ? (\n                <TableRow>\n                  <TableCell data-cy=\"browseClusterError\" colSpan={7}>\n                    <Typography align=\"center\">\n                      {t('workflowCluster.header.formControl.fetchingError')}\n                    </Typography>\n                  </TableCell>\n                </TableRow>\n              ) : filteredData ? (\n                filteredData\n                  .slice(\n                    paginationData.pageNo * paginationData.rowsPerPage,\n                    paginationData.pageNo * paginationData.rowsPerPage +\n                      paginationData.rowsPerPage\n                  )\n                  .map((data: Cluster) => (\n                    <TableRow\n                      data-cy=\"browseClusterData\"\n                      key={data.cluster_id}\n                      className={classes.dataRow}\n                    >\n                      <TableData data={data} deleteRow={deleteRow} />\n                    </TableRow>\n                  ))\n              ) : (\n                <TableRow>\n                  <TableCell data-cy=\"browseClusterNoData\" colSpan={0}>\n                    <Typography align=\"center\">\n                      {t('workflowCluster.header.formControl.recordAvailable')}\n                    </Typography>\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </TableContainer>\n\n        {/* Pagination Section */}\n        <TablePagination\n          rowsPerPageOptions={[5, 10, 25]}\n          component=\"div\"\n          count={filteredData?.length ?? 0}\n          rowsPerPage={paginationData.rowsPerPage}\n          page={paginationData.pageNo}\n          onChangePage={(_, page) =>\n            setPaginationData({ ...paginationData, pageNo: page })\n          }\n          onChangeRowsPerPage={(event) => {\n            setPaginationData({\n              ...paginationData,\n              pageNo: 0,\n              rowsPerPage: parseInt(event.target.value, 10),\n            });\n          }}\n        />\n      </Paper>\n    </div>\n  );\n};\n\nexport default BrowseCluster;\n"]},"metadata":{},"sourceType":"module"}