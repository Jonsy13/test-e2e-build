{"ast":null,"code":"import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useQuery}from'@apollo/client';import{LitmusThemeProvider}from'litmus-ui';import React,{lazy,Suspense,useEffect,useState}from'react';import{Redirect,Route,Router,Switch}from'react-router-dom';import Loader from'../../components/Loader';import{GET_PROJECT,LIST_PROJECTS}from'../../graphql';import{UserRole}from'../../models/graphql/user';import useActions from'../../redux/actions';import*as AnalyticsActions from'../../redux/actions/analytics';import{history}from'../../redux/configureStore';import{getToken,getUserId,getUserRole}from'../../utils/auth';import{getProjectID,getProjectRole}from'../../utils/getSearchParams';var ErrorPage=lazy(function(){return import('../../pages/ErrorPage');});var Workflows=lazy(function(){return import('../../pages/Workflows');});var CreateWorkflow=lazy(function(){return import('../../pages/CreateWorkflow');});var LoginPage=lazy(function(){return import('../../pages/LoginPage');});var GetStarted=lazy(function(){return import('../../pages/GetStartedPage');});var WorkflowDetails=lazy(function(){return import('../../pages/WorkflowDetails');});var HomePage=lazy(function(){return import('../../pages/HomePage');});var Community=lazy(function(){return import('../../pages/Community');});var Settings=lazy(function(){return import('../../pages/Settings');});var Usage=lazy(function(){return import('../../pages/Usage');});var Targets=lazy(function(){return import('../../pages/Targets');});var EditSchedule=lazy(function(){return import('../../pages/EditSchedule');});var SetNewSchedule=lazy(function(){return import('../../pages/EditSchedule/Schedule');});var ConnectTargets=lazy(function(){return import('../../pages/ConnectTarget');});var AnalyticsPage=lazy(function(){return import('../../pages/WorkflowAnalytics');});var AnalyticsDashboard=lazy(function(){return import('../../pages/AnalyticsPage');});var DataSourceConfigurePage=lazy(function(){return import('../../pages/ConfigureDataSources');});var ChooseAndConfigureDashboards=lazy(function(){return import('../../pages/ChooseAndConfigureDashboards');});var DashboardPage=lazy(function(){return import('../../pages/ApplicationDashboard');});var MyHub=lazy(function(){return import('../../pages/ChaosHub');});var ChaosChart=lazy(function(){return import('../../views/MyHub/MyHubCharts');});var MyHubExperiment=lazy(function(){return import('../../views/MyHub/MyHubExperiment');});var Routes=function Routes(){var baseRoute=window.location.pathname.split('/')[1];var projectIDFromURL=getProjectID();var projectRoleFromURL=getProjectRole();var role=getUserRole();var _useState=useState(projectIDFromURL),_useState2=_slicedToArray(_useState,2),projectID=_useState2[0],setprojectID=_useState2[1];var _useState3=useState(projectRoleFromURL),_useState4=_slicedToArray(_useState3,2),projectRole=_useState4[0],setprojectRole=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isProjectMember=_useState6[0],setIsProjectMember=_useState6[1];var userID=getUserId();var _useQuery=useQuery(LIST_PROJECTS,{skip:projectID!==''&&projectID!==undefined,onCompleted:function onCompleted(data){if(data.listProjects){data.listProjects.forEach(function(project){project.members.forEach(function(member){if(member.user_id===userID&&member.role==='Owner'){setprojectID(project.id);setprojectRole(member.role);history.push({pathname:\"/\".concat(baseRoute),search:\"?projectID=\".concat(project.id,\"&projectRole=\").concat(member.role)});}});});}},fetchPolicy:'cache-and-network'}),loading=_useQuery.loading;history.listen(function(location){if(location.pathname!=='/login'){setprojectID(getProjectID());setprojectRole(getProjectRole());}});var _useQuery2=useQuery(GET_PROJECT,{variables:{projectID:projectID},onCompleted:function onCompleted(data){if(data===null||data===void 0?void 0:data.getProject){data.getProject.members.forEach(function(member){if(member.user_id===userID){setIsProjectMember(true);setprojectID(data.getProject.id);setprojectRole(member.role);}});if(!isProjectMember){setprojectID('');setprojectRole('');}}},onError:function onError(){if(!isProjectMember){setprojectID('');setprojectRole('');}}}),projectValidation=_useQuery2.loading;if(getToken()===''){return/*#__PURE__*/React.createElement(React.Fragment,null,loading?/*#__PURE__*/React.createElement(Loader,null):/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/login\",component:LoginPage}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/api-doc\",to:\"/api-doc/index.html\"}),/*#__PURE__*/React.createElement(Redirect,{to:\"/login\"})));}if(!projectID){return/*#__PURE__*/React.createElement(React.Fragment,null,loading?/*#__PURE__*/React.createElement(Loader,null):/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/getStarted\",component:GetStarted}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/api-doc\",to:\"/api-doc/index.html\"})));}return/*#__PURE__*/React.createElement(React.Fragment,null,projectValidation&&loading?/*#__PURE__*/React.createElement(Loader,null):/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/home\",component:HomePage}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/\",to:\"/home\"}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/workflows\",component:Workflows}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/analytics\",component:AnalyticsDashboard}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/analytics/datasource/create\",component:function component(){return/*#__PURE__*/React.createElement(DataSourceConfigurePage,{configure:false});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/analytics/datasource/configure\",component:function component(){return/*#__PURE__*/React.createElement(DataSourceConfigurePage,{configure:true});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/analytics/dashboard/create\",component:function component(){return/*#__PURE__*/React.createElement(ChooseAndConfigureDashboards,{configure:false});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/analytics/dashboard/configure\",component:function component(){return/*#__PURE__*/React.createElement(ChooseAndConfigureDashboards,{configure:true});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/analytics/application-dashboard\",component:function component(){return/*#__PURE__*/React.createElement(DashboardPage,null);}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/create-workflow\",component:CreateWorkflow}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/workflows/:workflowRunId\",component:WorkflowDetails}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/workflows/schedule/:scheduleProjectID/:workflowName\",component:EditSchedule}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/workflows/schedule/:scheduleProjectID/:workflowName/set\",component:SetNewSchedule}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/workflows/analytics/:workflowRunId\",component:AnalyticsPage}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/community\",component:Community}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/targets\",component:Targets}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/target-connect\",component:ConnectTargets}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/myhub\",component:MyHub}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/myhub/:hubname\",component:ChaosChart}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/myhub/:hubname/:chart/:experiment\",component:MyHubExperiment}),projectRole==='Owner'?/*#__PURE__*/React.createElement(Route,{path:\"/settings\",component:Settings}):/*#__PURE__*/React.createElement(Redirect,{to:{pathname:'/home',search:\"?projectID=\".concat(projectID,\"&projectRole=\").concat(projectRole)}}),role===UserRole.admin?/*#__PURE__*/React.createElement(Route,{path:\"/usage\",component:Usage}):/*#__PURE__*/React.createElement(Redirect,{to:{pathname:'/home',search:\"?projectID=\".concat(projectID,\"&projectRole=\").concat(projectRole)}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/404\",component:ErrorPage}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/getStarted\",to:\"/home\"}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/workflows/schedule\",to:\"/workflows\"}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/workflows/template\",to:\"/workflows\"}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/analytics/overview\",to:\"/analytics\"}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/analytics/litmusdashboard\",to:\"/analytics\"}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/analytics/kubernetesdashborad\",to:\"/analytics\"}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/analytics/datasource\",to:\"/analytics\"}),/*#__PURE__*/React.createElement(Redirect,{exact:true,path:\"/api-doc\",to:\"/api-doc/index.html\"}),/*#__PURE__*/React.createElement(Redirect,{to:\"/404\"})));};function App(){var analyticsAction=useActions(AnalyticsActions);var token=getToken();useEffect(function(){if(token!==''){analyticsAction.loadCommunityAnalytics();}},[token]);return/*#__PURE__*/React.createElement(LitmusThemeProvider,null,/*#__PURE__*/React.createElement(Suspense,{fallback:/*#__PURE__*/React.createElement(\"div\",{style:{height:'100vh'}},/*#__PURE__*/React.createElement(Loader,null))},/*#__PURE__*/React.createElement(Router,{history:history},/*#__PURE__*/React.createElement(Routes,null))));}export default App;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/containers/app/App.tsx"],"names":["useQuery","LitmusThemeProvider","React","lazy","Suspense","useEffect","useState","Redirect","Route","Router","Switch","Loader","GET_PROJECT","LIST_PROJECTS","UserRole","useActions","AnalyticsActions","history","getToken","getUserId","getUserRole","getProjectID","getProjectRole","ErrorPage","Workflows","CreateWorkflow","LoginPage","GetStarted","WorkflowDetails","HomePage","Community","Settings","Usage","Targets","EditSchedule","SetNewSchedule","ConnectTargets","AnalyticsPage","AnalyticsDashboard","DataSourceConfigurePage","ChooseAndConfigureDashboards","DashboardPage","MyHub","ChaosChart","MyHubExperiment","Routes","baseRoute","window","location","pathname","split","projectIDFromURL","projectRoleFromURL","role","projectID","setprojectID","projectRole","setprojectRole","isProjectMember","setIsProjectMember","userID","skip","undefined","onCompleted","data","listProjects","forEach","project","members","member","user_id","id","push","search","fetchPolicy","loading","listen","variables","getProject","onError","projectValidation","admin","App","analyticsAction","token","loadCommunityAnalytics","height"],"mappings":"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","sourcesContent":["import { useQuery } from '@apollo/client';\nimport { LitmusThemeProvider } from 'litmus-ui';\nimport React, { lazy, Suspense, useEffect, useState } from 'react';\nimport { Redirect, Route, Router, Switch } from 'react-router-dom';\nimport Loader from '../../components/Loader';\nimport { GET_PROJECT, LIST_PROJECTS } from '../../graphql';\nimport {\n  Member,\n  ProjectDetail,\n  Projects,\n  UserRole,\n} from '../../models/graphql/user';\nimport useActions from '../../redux/actions';\nimport * as AnalyticsActions from '../../redux/actions/analytics';\nimport { history } from '../../redux/configureStore';\nimport { getToken, getUserId, getUserRole } from '../../utils/auth';\nimport { getProjectID, getProjectRole } from '../../utils/getSearchParams';\n\nconst ErrorPage = lazy(() => import('../../pages/ErrorPage'));\nconst Workflows = lazy(() => import('../../pages/Workflows'));\nconst CreateWorkflow = lazy(() => import('../../pages/CreateWorkflow'));\nconst LoginPage = lazy(() => import('../../pages/LoginPage'));\nconst GetStarted = lazy(() => import('../../pages/GetStartedPage'));\nconst WorkflowDetails = lazy(() => import('../../pages/WorkflowDetails'));\nconst HomePage = lazy(() => import('../../pages/HomePage'));\nconst Community = lazy(() => import('../../pages/Community'));\nconst Settings = lazy(() => import('../../pages/Settings'));\nconst Usage = lazy(() => import('../../pages/Usage'));\nconst Targets = lazy(() => import('../../pages/Targets'));\nconst EditSchedule = lazy(() => import('../../pages/EditSchedule'));\nconst SetNewSchedule = lazy(() => import('../../pages/EditSchedule/Schedule'));\nconst ConnectTargets = lazy(() => import('../../pages/ConnectTarget'));\nconst AnalyticsPage = lazy(() => import('../../pages/WorkflowAnalytics'));\nconst AnalyticsDashboard = lazy(() => import('../../pages/AnalyticsPage'));\nconst DataSourceConfigurePage = lazy(\n  () => import('../../pages/ConfigureDataSources')\n);\nconst ChooseAndConfigureDashboards = lazy(\n  () => import('../../pages/ChooseAndConfigureDashboards')\n);\nconst DashboardPage = lazy(() => import('../../pages/ApplicationDashboard'));\nconst MyHub = lazy(() => import('../../pages/ChaosHub'));\nconst ChaosChart = lazy(() => import('../../views/MyHub/MyHubCharts'));\nconst MyHubExperiment = lazy(() => import('../../views/MyHub/MyHubExperiment'));\n\nconst Routes: React.FC = () => {\n  const baseRoute = window.location.pathname.split('/')[1];\n  const projectIDFromURL = getProjectID();\n  const projectRoleFromURL = getProjectRole();\n  const role = getUserRole();\n  const [projectID, setprojectID] = useState<string>(projectIDFromURL);\n  const [projectRole, setprojectRole] = useState<string>(projectRoleFromURL);\n  const [isProjectMember, setIsProjectMember] = useState<boolean>(false);\n  const userID = getUserId();\n\n  const { loading } = useQuery<Projects>(LIST_PROJECTS, {\n    skip: projectID !== '' && projectID !== undefined,\n    onCompleted: (data) => {\n      if (data.listProjects) {\n        data.listProjects.forEach((project): void => {\n          project.members.forEach((member: Member): void => {\n            if (member.user_id === userID && member.role === 'Owner') {\n              setprojectID(project.id);\n              setprojectRole(member.role);\n              history.push({\n                pathname: `/${baseRoute}`,\n                search: `?projectID=${project.id}&projectRole=${member.role}`,\n              });\n            }\n          });\n        });\n      }\n    },\n    fetchPolicy: 'cache-and-network',\n  });\n\n  history.listen((location) => {\n    if (location.pathname !== '/login') {\n      setprojectID(getProjectID());\n      setprojectRole(getProjectRole());\n    }\n  });\n\n  const { loading: projectValidation } = useQuery<ProjectDetail>(GET_PROJECT, {\n    variables: { projectID },\n    onCompleted: (data) => {\n      if (data?.getProject) {\n        data.getProject.members.forEach((member: Member) => {\n          if (member.user_id === userID) {\n            setIsProjectMember(true);\n            setprojectID(data.getProject.id);\n            setprojectRole(member.role);\n          }\n        });\n        if (!isProjectMember) {\n          setprojectID('');\n          setprojectRole('');\n        }\n      }\n    },\n    onError: () => {\n      if (!isProjectMember) {\n        setprojectID('');\n        setprojectRole('');\n      }\n    },\n  });\n\n  if (getToken() === '') {\n    return (\n      <>\n        {loading ? (\n          <Loader />\n        ) : (\n          <Switch>\n            <Route exact path=\"/login\" component={LoginPage} />\n            <Redirect exact path=\"/api-doc\" to=\"/api-doc/index.html\" />\n            <Redirect to=\"/login\" />\n          </Switch>\n        )}\n      </>\n    );\n  }\n\n  if (!projectID) {\n    return (\n      <>\n        {loading ? (\n          <Loader />\n        ) : (\n          <Switch>\n            <Route exact path=\"/getStarted\" component={GetStarted} />\n            <Redirect exact path=\"/api-doc\" to=\"/api-doc/index.html\" />\n          </Switch>\n        )}\n      </>\n    );\n  }\n\n  return (\n    <>\n      {projectValidation && loading ? (\n        <Loader />\n      ) : (\n        <Switch>\n          <Route exact path=\"/home\" component={HomePage} />\n          <Redirect exact path=\"/\" to=\"/home\" />\n          <Route exact path=\"/workflows\" component={Workflows} />\n          <Route exact path=\"/analytics\" component={AnalyticsDashboard} />\n          <Route\n            exact\n            path=\"/analytics/datasource/create\"\n            component={() => <DataSourceConfigurePage configure={false} />}\n          />\n          <Route\n            exact\n            path=\"/analytics/datasource/configure\"\n            component={() => <DataSourceConfigurePage configure />}\n          />\n          <Route\n            exact\n            path=\"/analytics/dashboard/create\"\n            component={() => <ChooseAndConfigureDashboards configure={false} />}\n          />\n          <Route\n            exact\n            path=\"/analytics/dashboard/configure\"\n            component={() => <ChooseAndConfigureDashboards configure />}\n          />\n          <Route\n            exact\n            path=\"/analytics/application-dashboard\"\n            component={() => <DashboardPage />}\n          />\n          <Route exact path=\"/create-workflow\" component={CreateWorkflow} />\n          <Route\n            exact\n            path=\"/workflows/:workflowRunId\"\n            component={WorkflowDetails}\n          />\n          <Route\n            exact\n            path=\"/workflows/schedule/:scheduleProjectID/:workflowName\"\n            component={EditSchedule}\n          />\n          <Route\n            exact\n            path=\"/workflows/schedule/:scheduleProjectID/:workflowName/set\"\n            component={SetNewSchedule}\n          />\n          <Route\n            exact\n            path=\"/workflows/analytics/:workflowRunId\"\n            component={AnalyticsPage}\n          />\n          <Route exact path=\"/community\" component={Community} />\n          <Route exact path=\"/targets\" component={Targets} />\n          <Route exact path=\"/target-connect\" component={ConnectTargets} />\n          <Route exact path=\"/myhub\" component={MyHub} />\n          <Route exact path=\"/myhub/:hubname\" component={ChaosChart} />\n          <Route\n            exact\n            path=\"/myhub/:hubname/:chart/:experiment\"\n            component={MyHubExperiment}\n          />\n          {projectRole === 'Owner' ? (\n            <Route path=\"/settings\" component={Settings} />\n          ) : (\n            <Redirect\n              to={{\n                pathname: '/home',\n                search: `?projectID=${projectID}&projectRole=${projectRole}`,\n              }}\n            />\n          )}\n          {role === UserRole.admin ? (\n            <Route path=\"/usage\" component={Usage} />\n          ) : (\n            <Redirect\n              to={{\n                pathname: '/home',\n                search: `?projectID=${projectID}&projectRole=${projectRole}`,\n              }}\n            />\n          )}\n          <Route exact path=\"/404\" component={ErrorPage} />\n          {/* Redirects */}\n          <Redirect exact path=\"/getStarted\" to=\"/home\" />\n          <Redirect exact path=\"/workflows/schedule\" to=\"/workflows\" />\n          <Redirect exact path=\"/workflows/template\" to=\"/workflows\" />\n          <Redirect exact path=\"/analytics/overview\" to=\"/analytics\" />\n          <Redirect exact path=\"/analytics/litmusdashboard\" to=\"/analytics\" />\n          <Redirect\n            exact\n            path=\"/analytics/kubernetesdashborad\"\n            to=\"/analytics\"\n          />\n          <Redirect exact path=\"/analytics/datasource\" to=\"/analytics\" />\n          <Redirect exact path=\"/api-doc\" to=\"/api-doc/index.html\" />\n          <Redirect to=\"/404\" />\n        </Switch>\n      )}\n    </>\n  );\n};\n\nfunction App() {\n  const analyticsAction = useActions(AnalyticsActions);\n  const token = getToken();\n  useEffect(() => {\n    if (token !== '') {\n      analyticsAction.loadCommunityAnalytics();\n    }\n  }, [token]);\n  return (\n    <LitmusThemeProvider>\n      <Suspense\n        fallback={\n          <div style={{ height: '100vh' }}>\n            <Loader />\n          </div>\n        }\n      >\n        <Router history={history}>\n          {/* <Routes /> */}\n          <Routes />\n        </Router>\n      </Suspense>\n    </LitmusThemeProvider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}