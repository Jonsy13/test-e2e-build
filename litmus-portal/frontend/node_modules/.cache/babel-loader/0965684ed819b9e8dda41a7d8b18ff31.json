{"ast":null,"code":"import _objectSpread from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useMutation,useQuery}from'@apollo/client';import{FormControl,IconButton,InputAdornment,InputBase,InputLabel,MenuItem,Paper,Select,Table,TableBody,TableCell,TableContainer,TableHead,TablePagination,TableRow,Typography}from'@material-ui/core';import ExpandLessIcon from'@material-ui/icons/ExpandLess';import ExpandMoreIcon from'@material-ui/icons/ExpandMore';import SearchIcon from'@material-ui/icons/Search';import React,{useState}from'react';import{useTranslation}from'react-i18next';import YAML from'yaml';import Loader from'../../../components/Loader';import{DELETE_WORKFLOW,GET_CLUSTER_NAMES,UPDATE_SCHEDULE,WORKFLOW_LIST_DETAILS}from'../../../graphql';import{getProjectID}from'../../../utils/getSearchParams';import useStyles from'./styles';import TableData from'./TableData';var BrowseSchedule=function BrowseSchedule(){var _clusterList$getClust,_filteredWorkflows$le;var classes=useStyles();var projectID=getProjectID();var _useTranslation=useTranslation(),t=_useTranslation.t;// State for pagination\nvar _useState=useState({page:0,limit:10}),_useState2=_slicedToArray(_useState,2),paginationData=_useState2[0],setPaginationData=_useState2[1];// States for filters\nvar _useState3=useState({workflow_name:'',cluster_name:'All',suspended:'All'}),_useState4=_slicedToArray(_useState3,2),filters=_useState4[0],setFilters=_useState4[1];// State for sorting\nvar _useState5=useState({field:'Name',descending:true}),_useState6=_slicedToArray(_useState5,2),sortData=_useState6[0],setSortData=_useState6[1];// Apollo query to get the scheduled data\nvar _useQuery=useQuery(WORKFLOW_LIST_DETAILS,{variables:{workflowInput:{project_id:projectID,pagination:{page:paginationData.page,limit:paginationData.limit},sort:sortData,filter:{workflow_name:filters.workflow_name,cluster_name:filters.cluster_name}}},fetchPolicy:'cache-and-network'}),data=_useQuery.data,refetch=_useQuery.refetch,loading=_useQuery.loading,error=_useQuery.error;// Apollo mutation to delete the selected schedule\nvar _useMutation=useMutation(DELETE_WORKFLOW,{onCompleted:function onCompleted(){return refetch();}}),_useMutation2=_slicedToArray(_useMutation,1),deleteSchedule=_useMutation2[0];// State for search and filtering\nvar _useMutation3=useMutation(UPDATE_SCHEDULE,{onCompleted:function onCompleted(){return refetch();}}),_useMutation4=_slicedToArray(_useMutation3,1),updateSchedule=_useMutation4[0];// Disable and re-enable a schedule\nvar handleToggleSchedule=function handleToggleSchedule(schedule){var yaml=YAML.parse(schedule.workflow_manifest);if(yaml.spec.suspend===undefined||yaml.spec.suspend===false){yaml.spec.suspend=true;}else{yaml.spec.suspend=false;}var weightData=[];schedule.weightages.forEach(function(weightEntry){weightData.push({experiment_name:weightEntry.experiment_name,weightage:weightEntry.weightage});});updateSchedule({variables:{ChaosWorkFlowInput:{workflow_id:schedule.workflow_id,workflow_name:schedule.workflow_name,workflow_description:schedule.workflow_description,isCustomWorkflow:schedule.isCustomWorkflow,cronSyntax:schedule.cronSyntax,workflow_manifest:JSON.stringify(yaml,null,2),project_id:schedule.project_id,cluster_id:schedule.cluster_id,weightages:weightData}}});};// Query to get list of Clusters\nvar _useQuery2=useQuery(GET_CLUSTER_NAMES,{variables:{project_id:projectID}}),clusterList=_useQuery2.data;var filteredWorkflows=data===null||data===void 0?void 0:data.ListWorkflow.workflows.filter(function(dataRow){return filters.suspended==='All'?true:filters.suspended==='true'?YAML.parse(dataRow.workflow_manifest).spec.suspend===true:filters.suspended==='false'?YAML.parse(dataRow.workflow_manifest).spec.suspend===undefined:false;});var deleteRow=function deleteRow(wfid){deleteSchedule({variables:{workflowid:wfid,workflow_run_id:''}});};return/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"workflowSchedulesTable\"},/*#__PURE__*/React.createElement(\"section\",{className:\"Heading section\"},/*#__PURE__*/React.createElement(\"div\",{className:classes.headerSection},/*#__PURE__*/React.createElement(InputBase,{id:\"input-with-icon-adornment\",placeholder:\"Search\",className:classes.search,value:filters.workflow_name,onChange:function onChange(event){return setFilters(_objectSpread(_objectSpread({},filters),{},{workflow_name:event.target.value}));},startAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"start\"},/*#__PURE__*/React.createElement(SearchIcon,null))}),/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",className:classes.formControl,focused:true},/*#__PURE__*/React.createElement(InputLabel,{className:classes.selectText},\"Name\"),/*#__PURE__*/React.createElement(Select,{value:filters.suspended,onChange:function onChange(event){return setFilters(_objectSpread(_objectSpread({},filters),{},{suspended:event.target.value}));},label:\"Name\",className:classes.selectText},/*#__PURE__*/React.createElement(MenuItem,{value:\"All\"},t('chaosWorkflows.browseSchedules.options.all')),/*#__PURE__*/React.createElement(MenuItem,{value:\"false\"},t('chaosWorkflows.browseSchedules.options.enabledOnly')),/*#__PURE__*/React.createElement(MenuItem,{value:\"true\"},t('chaosWorkflows.browseSchedules.options.disabledOnly')))),/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",className:classes.formControl,color:\"primary\",focused:true},/*#__PURE__*/React.createElement(InputLabel,{className:classes.selectText},\"Target Agent\"),/*#__PURE__*/React.createElement(Select,{value:filters.cluster_name,onChange:function onChange(event){return setFilters(_objectSpread(_objectSpread({},filters),{},{cluster_name:event.target.value}));},label:\"Target Cluster\",className:classes.selectText},/*#__PURE__*/React.createElement(MenuItem,{value:\"All\"},\"All\"),clusterList===null||clusterList===void 0?void 0:(_clusterList$getClust=clusterList.getCluster)===null||_clusterList$getClust===void 0?void 0:_clusterList$getClust.map(function(cluster){return/*#__PURE__*/React.createElement(MenuItem,{key:cluster.cluster_name,value:cluster.cluster_name},cluster.cluster_name);}))))),/*#__PURE__*/React.createElement(Paper,{className:classes.root},/*#__PURE__*/React.createElement(TableContainer,{\"data-cy\":\"browseScheduleTable\",className:classes.tableMain},/*#__PURE__*/React.createElement(Table,{stickyHeader:true,\"aria-label\":\"simple table\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,{className:classes.tableHead},/*#__PURE__*/React.createElement(TableCell,{className:classes.workflowName},/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',flexDirection:'row'}},/*#__PURE__*/React.createElement(Typography,{style:{paddingLeft:30,paddingTop:12}},t('chaosWorkflows.browseSchedules.name')),/*#__PURE__*/React.createElement(\"div\",{className:classes.sortDiv},/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"sort name ascending\",size:\"small\",onClick:function onClick(){return setSortData({field:'Name',descending:false});}},/*#__PURE__*/React.createElement(ExpandLessIcon,{fontSize:\"inherit\"})),/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"sort name descending\",size:\"small\",onClick:function onClick(){return setSortData({field:'Name',descending:true});}},/*#__PURE__*/React.createElement(ExpandMoreIcon,{fontSize:\"inherit\"}))))),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Typography,{className:classes.targetCluster},t('chaosWorkflows.browseSchedules.agent'))),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Typography,{className:classes.showExp},t('chaosWorkflows.browseSchedules.experiments'))),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Typography,{className:classes.showExp},t('chaosWorkflows.browseSchedules.schedule'))),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Typography,{className:classes.showExp},t('chaosWorkflows.browseSchedules.nextRun'))),/*#__PURE__*/React.createElement(TableCell,null))),/*#__PURE__*/React.createElement(TableBody,null,loading?/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{colSpan:7},/*#__PURE__*/React.createElement(Loader,null))):error?/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{\"data-cy\":\"browseScheduleError\",colSpan:7},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},\"Unable to fetch data\"))):filteredWorkflows&&filteredWorkflows.length?filteredWorkflows.map(function(data){return/*#__PURE__*/React.createElement(TableRow,{\"data-cy\":\"workflowSchedulesTableRow\",key:data.workflow_id},/*#__PURE__*/React.createElement(TableData,{data:data,deleteRow:deleteRow,handleToggleSchedule:handleToggleSchedule}));}):/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{\"data-cy\":\"browseScheduleNoData\",colSpan:7},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},\"No records available\")))))),/*#__PURE__*/React.createElement(TablePagination,{rowsPerPageOptions:[10,25,50],component:\"div\",count:(_filteredWorkflows$le=filteredWorkflows===null||filteredWorkflows===void 0?void 0:filteredWorkflows.length)!==null&&_filteredWorkflows$le!==void 0?_filteredWorkflows$le:0,rowsPerPage:paginationData.limit,page:paginationData.page,onChangePage:function onChangePage(_,page){return setPaginationData(_objectSpread(_objectSpread({},paginationData),{},{page:page}));},onChangeRowsPerPage:function onChangeRowsPerPage(event){setPaginationData(_objectSpread(_objectSpread({},paginationData),{},{page:0,limit:parseInt(event.target.value,10)}));}})));};export default BrowseSchedule;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/ChaosWorkflows/BrowseSchedule/index.tsx"],"names":["useMutation","useQuery","FormControl","IconButton","InputAdornment","InputBase","InputLabel","MenuItem","Paper","Select","Table","TableBody","TableCell","TableContainer","TableHead","TablePagination","TableRow","Typography","ExpandLessIcon","ExpandMoreIcon","SearchIcon","React","useState","useTranslation","YAML","Loader","DELETE_WORKFLOW","GET_CLUSTER_NAMES","UPDATE_SCHEDULE","WORKFLOW_LIST_DETAILS","getProjectID","useStyles","TableData","BrowseSchedule","classes","projectID","t","page","limit","paginationData","setPaginationData","workflow_name","cluster_name","suspended","filters","setFilters","field","descending","sortData","setSortData","variables","workflowInput","project_id","pagination","sort","filter","fetchPolicy","data","refetch","loading","error","onCompleted","deleteSchedule","updateSchedule","handleToggleSchedule","schedule","yaml","parse","workflow_manifest","spec","suspend","undefined","weightData","weightages","forEach","weightEntry","push","experiment_name","weightage","ChaosWorkFlowInput","workflow_id","workflow_description","isCustomWorkflow","cronSyntax","JSON","stringify","cluster_id","clusterList","filteredWorkflows","ListWorkflow","workflows","dataRow","deleteRow","wfid","workflowid","workflow_run_id","headerSection","search","event","target","value","formControl","selectText","getCluster","map","cluster","root","tableMain","tableHead","workflowName","display","flexDirection","paddingLeft","paddingTop","sortDiv","targetCluster","showExp","length","_","parseInt"],"mappings":"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","sourcesContent":["import { useMutation, useQuery } from '@apollo/client';\nimport {\n  FormControl,\n  IconButton,\n  InputAdornment,\n  InputBase,\n  InputLabel,\n  MenuItem,\n  Paper,\n  Select,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TablePagination,\n  TableRow,\n  Typography,\n} from '@material-ui/core';\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport SearchIcon from '@material-ui/icons/Search';\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport YAML from 'yaml';\nimport Loader from '../../../components/Loader';\nimport {\n  DELETE_WORKFLOW,\n  GET_CLUSTER_NAMES,\n  UPDATE_SCHEDULE,\n  WORKFLOW_LIST_DETAILS,\n} from '../../../graphql';\nimport { Clusters, ClusterVars } from '../../../models/graphql/clusterData';\nimport { WeightMap } from '../../../models/graphql/createWorkflowData';\nimport { DeleteSchedule } from '../../../models/graphql/scheduleData';\nimport {\n  ListWorkflowsInput,\n  Pagination,\n  ScheduledWorkflow,\n  ScheduledWorkflows,\n  SortInput,\n  WorkflowFilterInput,\n} from '../../../models/graphql/workflowListData';\nimport { getProjectID } from '../../../utils/getSearchParams';\nimport useStyles from './styles';\nimport TableData from './TableData';\n\ninterface FilterOption extends WorkflowFilterInput {\n  suspended?: string;\n}\n\nconst BrowseSchedule: React.FC = () => {\n  const classes = useStyles();\n  const projectID = getProjectID();\n  const { t } = useTranslation();\n\n  // State for pagination\n  const [paginationData, setPaginationData] = useState<Pagination>({\n    page: 0,\n    limit: 10,\n  });\n\n  // States for filters\n  const [filters, setFilters] = useState<FilterOption>({\n    workflow_name: '',\n    cluster_name: 'All',\n    suspended: 'All',\n  });\n\n  // State for sorting\n  const [sortData, setSortData] = useState<SortInput>({\n    field: 'Name',\n    descending: true,\n  });\n\n  // Apollo query to get the scheduled data\n  const { data, refetch, loading, error } = useQuery<\n    ScheduledWorkflows,\n    ListWorkflowsInput\n  >(WORKFLOW_LIST_DETAILS, {\n    variables: {\n      workflowInput: {\n        project_id: projectID,\n        pagination: {\n          page: paginationData.page,\n          limit: paginationData.limit,\n        },\n        sort: sortData,\n        filter: {\n          workflow_name: filters.workflow_name,\n          cluster_name: filters.cluster_name,\n        },\n      },\n    },\n    fetchPolicy: 'cache-and-network',\n  });\n\n  // Apollo mutation to delete the selected schedule\n  const [deleteSchedule] = useMutation<DeleteSchedule>(DELETE_WORKFLOW, {\n    onCompleted: () => refetch(),\n  });\n\n  // State for search and filtering\n\n  const [updateSchedule] = useMutation(UPDATE_SCHEDULE, {\n    onCompleted: () => refetch(),\n  });\n\n  // Disable and re-enable a schedule\n  const handleToggleSchedule = (schedule: ScheduledWorkflow) => {\n    const yaml = YAML.parse(schedule.workflow_manifest);\n    if (yaml.spec.suspend === undefined || yaml.spec.suspend === false) {\n      yaml.spec.suspend = true;\n    } else {\n      yaml.spec.suspend = false;\n    }\n\n    const weightData: WeightMap[] = [];\n\n    schedule.weightages.forEach((weightEntry) => {\n      weightData.push({\n        experiment_name: weightEntry.experiment_name,\n        weightage: weightEntry.weightage,\n      });\n    });\n\n    updateSchedule({\n      variables: {\n        ChaosWorkFlowInput: {\n          workflow_id: schedule.workflow_id,\n          workflow_name: schedule.workflow_name,\n          workflow_description: schedule.workflow_description,\n          isCustomWorkflow: schedule.isCustomWorkflow,\n          cronSyntax: schedule.cronSyntax,\n          workflow_manifest: JSON.stringify(yaml, null, 2),\n          project_id: schedule.project_id,\n          cluster_id: schedule.cluster_id,\n          weightages: weightData,\n        },\n      },\n    });\n  };\n\n  // Query to get list of Clusters\n  const { data: clusterList } = useQuery<Partial<Clusters>, ClusterVars>(\n    GET_CLUSTER_NAMES,\n    {\n      variables: {\n        project_id: projectID,\n      },\n    }\n  );\n\n  const filteredWorkflows = data?.ListWorkflow.workflows.filter((dataRow) =>\n    filters.suspended === 'All'\n      ? true\n      : filters.suspended === 'true'\n      ? YAML.parse(dataRow.workflow_manifest).spec.suspend === true\n      : filters.suspended === 'false'\n      ? YAML.parse(dataRow.workflow_manifest).spec.suspend === undefined\n      : false\n  );\n\n  const deleteRow = (wfid: string) => {\n    deleteSchedule({\n      variables: { workflowid: wfid, workflow_run_id: '' },\n    });\n  };\n  return (\n    <div data-cy=\"workflowSchedulesTable\">\n      <section className=\"Heading section\">\n        <div className={classes.headerSection}>\n          {/* Search Field */}\n          <InputBase\n            id=\"input-with-icon-adornment\"\n            placeholder=\"Search\"\n            className={classes.search}\n            value={filters.workflow_name}\n            onChange={(event) =>\n              setFilters({\n                ...filters,\n                workflow_name: event.target.value as string,\n              })\n            }\n            startAdornment={\n              <InputAdornment position=\"start\">\n                <SearchIcon />\n              </InputAdornment>\n            }\n          />\n\n          <FormControl\n            variant=\"outlined\"\n            className={classes.formControl}\n            focused\n          >\n            <InputLabel className={classes.selectText}>Name</InputLabel>\n            <Select\n              value={filters.suspended}\n              onChange={(event) =>\n                setFilters({\n                  ...filters,\n                  suspended: event.target.value as string,\n                })\n              }\n              label=\"Name\"\n              className={classes.selectText}\n            >\n              <MenuItem value=\"All\">\n                {t('chaosWorkflows.browseSchedules.options.all')}\n              </MenuItem>\n              <MenuItem value=\"false\">\n                {t('chaosWorkflows.browseSchedules.options.enabledOnly')}\n              </MenuItem>\n              <MenuItem value=\"true\">\n                {t('chaosWorkflows.browseSchedules.options.disabledOnly')}\n              </MenuItem>\n            </Select>\n          </FormControl>\n\n          {/* Select Cluster */}\n          <FormControl\n            variant=\"outlined\"\n            className={classes.formControl}\n            color=\"primary\"\n            focused\n          >\n            <InputLabel className={classes.selectText}>Target Agent</InputLabel>\n            <Select\n              value={filters.cluster_name}\n              onChange={(event) =>\n                setFilters({\n                  ...filters,\n                  cluster_name: event.target.value as string,\n                })\n              }\n              label=\"Target Cluster\"\n              className={classes.selectText}\n            >\n              <MenuItem value=\"All\">All</MenuItem>\n              {clusterList?.getCluster?.map((cluster) => (\n                <MenuItem\n                  key={cluster.cluster_name}\n                  value={cluster.cluster_name}\n                >\n                  {cluster.cluster_name}\n                </MenuItem>\n              ))}\n            </Select>\n          </FormControl>\n        </div>\n      </section>\n      <Paper className={classes.root}>\n        {/* Table Header */}\n        <TableContainer\n          data-cy=\"browseScheduleTable\"\n          className={classes.tableMain}\n        >\n          <Table stickyHeader aria-label=\"simple table\">\n            <TableHead>\n              <TableRow className={classes.tableHead}>\n                {/* WorkFlow Name */}\n                <TableCell className={classes.workflowName}>\n                  <div style={{ display: 'flex', flexDirection: 'row' }}>\n                    <Typography style={{ paddingLeft: 30, paddingTop: 12 }}>\n                      {t('chaosWorkflows.browseSchedules.name')}\n                    </Typography>\n                    <div className={classes.sortDiv}>\n                      <IconButton\n                        aria-label=\"sort name ascending\"\n                        size=\"small\"\n                        onClick={() =>\n                          setSortData({\n                            field: 'Name',\n                            descending: false,\n                          })\n                        }\n                      >\n                        <ExpandLessIcon fontSize=\"inherit\" />\n                      </IconButton>\n                      <IconButton\n                        aria-label=\"sort name descending\"\n                        size=\"small\"\n                        onClick={() =>\n                          setSortData({\n                            field: 'Name',\n                            descending: true,\n                          })\n                        }\n                      >\n                        <ExpandMoreIcon fontSize=\"inherit\" />\n                      </IconButton>\n                    </div>\n                  </div>\n                </TableCell>\n\n                {/* Cluster */}\n                <TableCell>\n                  <Typography className={classes.targetCluster}>\n                    {t('chaosWorkflows.browseSchedules.agent')}\n                  </Typography>\n                </TableCell>\n\n                {/* Show Experiments */}\n                <TableCell>\n                  <Typography className={classes.showExp}>\n                    {t('chaosWorkflows.browseSchedules.experiments')}\n                  </Typography>\n                </TableCell>\n\n                {/* Show Schedule Details */}\n                <TableCell>\n                  <Typography className={classes.showExp}>\n                    {t('chaosWorkflows.browseSchedules.schedule')}\n                  </Typography>\n                </TableCell>\n\n                {/* Next Run */}\n                <TableCell>\n                  <Typography className={classes.showExp}>\n                    {t('chaosWorkflows.browseSchedules.nextRun')}\n                  </Typography>\n                </TableCell>\n\n                <TableCell />\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {loading ? (\n                <TableRow>\n                  <TableCell colSpan={7}>\n                    <Loader />\n                  </TableCell>\n                </TableRow>\n              ) : error ? (\n                <TableRow>\n                  <TableCell data-cy=\"browseScheduleError\" colSpan={7}>\n                    <Typography align=\"center\">Unable to fetch data</Typography>\n                  </TableCell>\n                </TableRow>\n              ) : filteredWorkflows && filteredWorkflows.length ? (\n                filteredWorkflows.map((data) => (\n                  <TableRow\n                    data-cy=\"workflowSchedulesTableRow\"\n                    key={data.workflow_id}\n                  >\n                    <TableData\n                      data={data}\n                      deleteRow={deleteRow}\n                      handleToggleSchedule={handleToggleSchedule}\n                    />\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell data-cy=\"browseScheduleNoData\" colSpan={7}>\n                    <Typography align=\"center\">No records available</Typography>\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </TableContainer>\n\n        {/* Pagination Section */}\n        <TablePagination\n          rowsPerPageOptions={[10, 25, 50]}\n          component=\"div\"\n          count={filteredWorkflows?.length ?? 0}\n          rowsPerPage={paginationData.limit}\n          page={paginationData.page}\n          onChangePage={(_, page) =>\n            setPaginationData({ ...paginationData, page })\n          }\n          onChangeRowsPerPage={(event) => {\n            setPaginationData({\n              ...paginationData,\n              page: 0,\n              limit: parseInt(event.target.value, 10),\n            });\n          }}\n        />\n      </Paper>\n    </div>\n  );\n};\n\nexport default BrowseSchedule;\n"]},"metadata":{},"sourceType":"module"}