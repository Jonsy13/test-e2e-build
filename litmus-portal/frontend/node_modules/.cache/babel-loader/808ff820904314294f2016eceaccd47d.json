{"ast":null,"code":"import _toConsumableArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useMutation,useQuery}from'@apollo/client';import{Avatar,Paper,Typography}from'@material-ui/core';import{ButtonFilled,ButtonOutlined}from'litmus-ui';import React,{useEffect,useState}from'react';import{useTranslation}from'react-i18next';import{ACCEPT_INVITE,ALL_USERS,DECLINE_INVITE,LIST_PROJECTS}from'../../../../../graphql';import{getUserId}from'../../../../../utils/auth';import{userInitials}from'../../../../../utils/userInitials';import useStyles from'./styles';var ReceivedInvitations=function ReceivedInvitations(){var classes=useStyles();var _useTranslation=useTranslation(),t=_useTranslation.t;// for response data\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),rows=_useState2[0],setRows=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),allUsers=_useState4[0],setAllUsers=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];// stores the user whose invitation is accepted/declined\nvar _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),acceptDecline=_useState8[0],setAcceptDecline=_useState8[1];var userID=getUserId();// mutation to accept the invitation\nvar _useMutation=useMutation(ACCEPT_INVITE,{onCompleted:function onCompleted(){setRows(rows.filter(function(row){return row.user_id!==acceptDecline;}));},refetchQueries:[{query:LIST_PROJECTS}]}),_useMutation2=_slicedToArray(_useMutation,1),acceptInvite=_useMutation2[0];// mutation to decline the invitation\nvar _useMutation3=useMutation(DECLINE_INVITE,{onCompleted:function onCompleted(){setRows(rows.filter(function(row){return row.user_id!==acceptDecline;}));},refetchQueries:[{query:LIST_PROJECTS}]}),_useMutation4=_slicedToArray(_useMutation3,1),declineInvite=_useMutation4[0];var _useQuery=useQuery(LIST_PROJECTS,{fetchPolicy:'cache-and-network'}),data=_useQuery.data;useEffect(function(){var _data$listProjects;var projectList=(_data$listProjects=data===null||data===void 0?void 0:data.listProjects)!==null&&_data$listProjects!==void 0?_data$listProjects:[];var users=[];var flag=0;var roleVar='';projectList.forEach(function(project){project.members.forEach(function(member){if(member.user_id===userID&&member.invitation==='Pending'){flag=1;roleVar=member.role;}});if(flag===1){project.members.forEach(function(member){if(member.user_id!==userID&&member.role==='Owner'){users.push({projectID:project.id,projectName:project.name,role:roleVar,user_id:member.user_id,user_name:member.user_name});}});flag=0;}});setRows([].concat(users));},[data]);useQuery(ALL_USERS,{onCompleted:function onCompleted(data){setAllUsers(_toConsumableArray(data.users));setLoading(false);}});return/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"receivedInvitationModal\"},!loading?/*#__PURE__*/React.createElement(React.Fragment,null,rows.length>0?rows.map(function(row){return/*#__PURE__*/React.createElement(Paper,{className:classes.root,key:\"\".concat(row)},/*#__PURE__*/React.createElement(\"div\",{className:classes.avatarDiv},/*#__PURE__*/React.createElement(Avatar,{\"data-cy\":\"avatar\",alt:\"User\",className:classes.avatarBackground,style:{alignContent:'right'}},userInitials(allUsers.filter(function(data){return row.user_id===data.id;})[0].username)),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Typography,{className:classes.name},allUsers.filter(function(data){return row.user_id===data.id;})[0].username),/*#__PURE__*/React.createElement(Typography,{className:classes.email},t('settings.teamingTab.invitation.receivedInvitation.inviteTextFirst'),' ',row.role==='Editor'?'an':'a',' ',/*#__PURE__*/React.createElement(\"strong\",null,row.role),' ',t('settings.teamingTab.invitation.receivedInvitation.inviteTextSecond')))),/*#__PURE__*/React.createElement(\"div\",{className:classes.projectDiv},/*#__PURE__*/React.createElement(Typography,{className:classes.projectName},row.projectName)),/*#__PURE__*/React.createElement(\"div\",{className:classes.buttonDiv},/*#__PURE__*/React.createElement(ButtonOutlined,{className:classes.butnOutline,onClick:function onClick(){setAcceptDecline(row.user_id);declineInvite({variables:{member:{project_id:row.projectID,user_id:getUserId(),role:row.role}}});},disabled:false},/*#__PURE__*/React.createElement(\"div\",null,t('settings.teamingTab.invitation.receivedInvitation.button.ignore'))),/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"receivedInvitationAccept\"},/*#__PURE__*/React.createElement(ButtonFilled,{onClick:function onClick(){setAcceptDecline(row.user_id);acceptInvite({variables:{member:{project_id:row.projectID,user_id:getUserId(),role:row.role}}});},disabled:false},t('settings.teamingTab.invitation.receivedInvitation.button.accept')))),' ');}):/*#__PURE__*/React.createElement(React.Fragment,null)):/*#__PURE__*/React.createElement(React.Fragment,null));};export default ReceivedInvitations;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/Settings/TeamingTab/Invitation/ReceivedInvitations/index.tsx"],"names":["useMutation","useQuery","Avatar","Paper","Typography","ButtonFilled","ButtonOutlined","React","useEffect","useState","useTranslation","ACCEPT_INVITE","ALL_USERS","DECLINE_INVITE","LIST_PROJECTS","getUserId","userInitials","useStyles","ReceivedInvitations","classes","t","rows","setRows","allUsers","setAllUsers","loading","setLoading","acceptDecline","setAcceptDecline","userID","onCompleted","filter","row","user_id","refetchQueries","query","acceptInvite","declineInvite","fetchPolicy","data","projectList","listProjects","users","flag","roleVar","forEach","project","members","member","invitation","role","push","projectID","id","projectName","name","user_name","length","map","root","avatarDiv","avatarBackground","alignContent","username","email","projectDiv","buttonDiv","butnOutline","variables","project_id"],"mappings":"8WAAA,OAASA,WAAT,CAAsBC,QAAtB,KAAsC,gBAAtC,CACA,OAASC,MAAT,CAAiBC,KAAjB,CAAwBC,UAAxB,KAA0C,mBAA1C,CACA,OAASC,YAAT,CAAuBC,cAAvB,KAA6C,WAA7C,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,cAAT,KAA+B,eAA/B,CACA,OACEC,aADF,CAEEC,SAFF,CAGEC,cAHF,CAIEC,aAJF,KAKO,wBALP,CAWA,OAASC,SAAT,KAA0B,2BAA1B,CACA,OAASC,YAAT,KAA6B,mCAA7B,CACA,MAAOC,CAAAA,SAAP,KAAsB,UAAtB,CAUA,GAAMC,CAAAA,mBAA6B,CAAG,QAAhCA,CAAAA,mBAAgC,EAAM,CAC1C,GAAMC,CAAAA,OAAO,CAAGF,SAAS,EAAzB,CACA,oBAAcP,cAAc,EAA5B,CAAQU,CAAR,iBAAQA,CAAR,CACA;AACA,cAAwBX,QAAQ,CAAuB,EAAvB,CAAhC,wCAAOY,IAAP,eAAaC,OAAb,eACA,eAAgCb,QAAQ,CAAe,EAAf,CAAxC,yCAAOc,QAAP,eAAiBC,WAAjB,eACA,eAA8Bf,QAAQ,CAAC,IAAD,CAAtC,yCAAOgB,OAAP,eAAgBC,UAAhB,eAEA;AACA,eAA0CjB,QAAQ,CAAS,EAAT,CAAlD,yCAAOkB,aAAP,eAAsBC,gBAAtB,eAEA,GAAMC,CAAAA,MAAM,CAAGd,SAAS,EAAxB,CACA;AACA,iBAAuBf,WAAW,CAAmBW,aAAnB,CAAkC,CAClEmB,WAAW,CAAE,sBAAM,CACjBR,OAAO,CAACD,IAAI,CAACU,MAAL,CAAY,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,OAAJ,GAAgBN,aAAzB,EAAZ,CAAD,CAAP,CACD,CAHiE,CAIlEO,cAAc,CAAE,CAAC,CAAEC,KAAK,CAAErB,aAAT,CAAD,CAJkD,CAAlC,CAAlC,8CAAOsB,YAAP,kBAOA;AACA,kBAAwBpC,WAAW,CAAmBa,cAAnB,CAAmC,CACpEiB,WAAW,CAAE,sBAAM,CACjBR,OAAO,CAACD,IAAI,CAACU,MAAL,CAAY,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,OAAJ,GAAgBN,aAAzB,EAAZ,CAAD,CAAP,CACD,CAHmE,CAIpEO,cAAc,CAAE,CAAC,CAAEC,KAAK,CAAErB,aAAT,CAAD,CAJoD,CAAnC,CAAnC,+CAAOuB,aAAP,kBAOA,cAAiBpC,QAAQ,CAAWa,aAAX,CAA0B,CACjDwB,WAAW,CAAE,mBADoC,CAA1B,CAAzB,CAAQC,IAAR,WAAQA,IAAR,CAIA/B,SAAS,CAAC,UAAM,wBACd,GAAMgC,CAAAA,WAAW,qBAAGD,IAAH,SAAGA,IAAH,iBAAGA,IAAI,CAAEE,YAAT,yDAAyB,EAA1C,CACA,GAAMC,CAAAA,KAA2B,CAAG,EAApC,CAEA,GAAIC,CAAAA,IAAI,CAAG,CAAX,CACA,GAAIC,CAAAA,OAAO,CAAG,EAAd,CAEAJ,WAAW,CAACK,OAAZ,CAAoB,SAACC,OAAD,CAAa,CAC/BA,OAAO,CAACC,OAAR,CAAgBF,OAAhB,CAAwB,SAACG,MAAD,CAAY,CAClC,GAAIA,MAAM,CAACf,OAAP,GAAmBJ,MAAnB,EAA6BmB,MAAM,CAACC,UAAP,GAAsB,SAAvD,CAAkE,CAChEN,IAAI,CAAG,CAAP,CACAC,OAAO,CAAGI,MAAM,CAACE,IAAjB,CACD,CACF,CALD,EAMA,GAAIP,IAAI,GAAK,CAAb,CAAgB,CACdG,OAAO,CAACC,OAAR,CAAgBF,OAAhB,CAAwB,SAACG,MAAD,CAAY,CAClC,GAAIA,MAAM,CAACf,OAAP,GAAmBJ,MAAnB,EAA6BmB,MAAM,CAACE,IAAP,GAAgB,OAAjD,CAA0D,CACxDR,KAAK,CAACS,IAAN,CAAW,CACTC,SAAS,CAAEN,OAAO,CAACO,EADV,CAETC,WAAW,CAAER,OAAO,CAACS,IAFZ,CAGTL,IAAI,CAAEN,OAHG,CAITX,OAAO,CAAEe,MAAM,CAACf,OAJP,CAKTuB,SAAS,CAAER,MAAM,CAACQ,SALT,CAAX,EAOD,CACF,CAVD,EAWAb,IAAI,CAAG,CAAP,CACD,CACF,CArBD,EAsBArB,OAAO,WAAKoB,KAAL,EAAP,CACD,CA9BQ,CA8BN,CAACH,IAAD,CA9BM,CAAT,CAgCAtC,QAAQ,CAACW,SAAD,CAAY,CAClBkB,WAAW,CAAE,qBAACS,IAAD,CAAU,CACrBf,WAAW,oBAAKe,IAAI,CAACG,KAAV,EAAX,CACAhB,UAAU,CAAC,KAAD,CAAV,CACD,CAJiB,CAAZ,CAAR,CAOA,mBACE,2BAAK,UAAQ,yBAAb,EACG,CAACD,OAAD,cACC,wCACGJ,IAAI,CAACoC,MAAL,CAAc,CAAd,CACCpC,IAAI,CAACqC,GAAL,CAAS,SAAC1B,GAAD,qBACP,oBAAC,KAAD,EAAO,SAAS,CAAEb,OAAO,CAACwC,IAA1B,CAAgC,GAAG,WAAK3B,GAAL,CAAnC,eACE,2BAAK,SAAS,CAAEb,OAAO,CAACyC,SAAxB,eACE,oBAAC,MAAD,EACE,UAAQ,QADV,CAEE,GAAG,CAAC,MAFN,CAGE,SAAS,CAAEzC,OAAO,CAAC0C,gBAHrB,CAIE,KAAK,CAAE,CAAEC,YAAY,CAAE,OAAhB,CAJT,EAMG9C,YAAY,CACXO,QAAQ,CAACQ,MAAT,CAAgB,SAACQ,IAAD,CAAU,CACxB,MAAOP,CAAAA,GAAG,CAACC,OAAJ,GAAgBM,IAAI,CAACc,EAA5B,CACD,CAFD,EAEG,CAFH,EAEMU,QAHK,CANf,CADF,cAaE,4CACE,oBAAC,UAAD,EAAY,SAAS,CAAE5C,OAAO,CAACoC,IAA/B,EAEIhC,QAAQ,CAACQ,MAAT,CAAgB,SAACQ,IAAD,CAAU,CACxB,MAAOP,CAAAA,GAAG,CAACC,OAAJ,GAAgBM,IAAI,CAACc,EAA5B,CACD,CAFD,EAEG,CAFH,EAEMU,QAJV,CADF,cAQE,oBAAC,UAAD,EAAY,SAAS,CAAE5C,OAAO,CAAC6C,KAA/B,EACG5C,CAAC,CACA,mEADA,CADJ,CAGK,GAHL,CAIGY,GAAG,CAACkB,IAAJ,GAAa,QAAb,CAAwB,IAAxB,CAA+B,GAJlC,CAIuC,GAJvC,cAKE,kCAASlB,GAAG,CAACkB,IAAb,CALF,CAK8B,GAL9B,CAMG9B,CAAC,CACA,oEADA,CANJ,CARF,CAbF,CADF,cAkCE,2BAAK,SAAS,CAAED,OAAO,CAAC8C,UAAxB,eACE,oBAAC,UAAD,EAAY,SAAS,CAAE9C,OAAO,CAACmC,WAA/B,EACGtB,GAAG,CAACsB,WADP,CADF,CAlCF,cAuCE,2BAAK,SAAS,CAAEnC,OAAO,CAAC+C,SAAxB,eACE,oBAAC,cAAD,EACE,SAAS,CAAE/C,OAAO,CAACgD,WADrB,CAEE,OAAO,CAAE,kBAAM,CACbvC,gBAAgB,CAACI,GAAG,CAACC,OAAL,CAAhB,CACAI,aAAa,CAAC,CACZ+B,SAAS,CAAE,CACTpB,MAAM,CAAE,CACNqB,UAAU,CAAErC,GAAG,CAACoB,SADV,CAENnB,OAAO,CAAElB,SAAS,EAFZ,CAGNmC,IAAI,CAAElB,GAAG,CAACkB,IAHJ,CADC,CADC,CAAD,CAAb,CASD,CAbH,CAcE,QAAQ,CAAE,KAdZ,eAgBE,+BACG9B,CAAC,CACA,iEADA,CADJ,CAhBF,CADF,cAuBE,2BAAK,UAAQ,0BAAb,eACE,oBAAC,YAAD,EACE,OAAO,CAAE,kBAAM,CACbQ,gBAAgB,CAACI,GAAG,CAACC,OAAL,CAAhB,CACAG,YAAY,CAAC,CACXgC,SAAS,CAAE,CACTpB,MAAM,CAAE,CACNqB,UAAU,CAAErC,GAAG,CAACoB,SADV,CAENnB,OAAO,CAAElB,SAAS,EAFZ,CAGNmC,IAAI,CAAElB,GAAG,CAACkB,IAHJ,CADC,CADA,CAAD,CAAZ,CASD,CAZH,CAaE,QAAQ,CAAE,KAbZ,EAeG9B,CAAC,CACA,iEADA,CAfJ,CADF,CAvBF,CAvCF,CAmFS,GAnFT,CADO,EAAT,CADD,cAyFC,wCA1FJ,CADD,cA+FC,wCAhGJ,CADF,CAqGD,CA5KD,CA8KA,cAAeF,CAAAA,mBAAf","sourcesContent":["import { useMutation, useQuery } from '@apollo/client';\nimport { Avatar, Paper, Typography } from '@material-ui/core';\nimport { ButtonFilled, ButtonOutlined } from 'litmus-ui';\nimport React, { useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport {\n  ACCEPT_INVITE,\n  ALL_USERS,\n  DECLINE_INVITE,\n  LIST_PROJECTS,\n} from '../../../../../graphql';\nimport {\n  MemberInvitation,\n  UserInvite,\n} from '../../../../../models/graphql/invite';\nimport { Projects } from '../../../../../models/graphql/user';\nimport { getUserId } from '../../../../../utils/auth';\nimport { userInitials } from '../../../../../utils/userInitials';\nimport useStyles from './styles';\n\ninterface ReceivedInvitation {\n  projectName: string;\n  user_id: string;\n  role: string;\n  projectID: string;\n  user_name: string;\n}\n\nconst ReceivedInvitations: React.FC = () => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n  // for response data\n  const [rows, setRows] = useState<ReceivedInvitation[]>([]);\n  const [allUsers, setAllUsers] = useState<UserInvite[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // stores the user whose invitation is accepted/declined\n  const [acceptDecline, setAcceptDecline] = useState<string>('');\n\n  const userID = getUserId();\n  // mutation to accept the invitation\n  const [acceptInvite] = useMutation<MemberInvitation>(ACCEPT_INVITE, {\n    onCompleted: () => {\n      setRows(rows.filter((row) => row.user_id !== acceptDecline));\n    },\n    refetchQueries: [{ query: LIST_PROJECTS }],\n  });\n\n  // mutation to decline the invitation\n  const [declineInvite] = useMutation<MemberInvitation>(DECLINE_INVITE, {\n    onCompleted: () => {\n      setRows(rows.filter((row) => row.user_id !== acceptDecline));\n    },\n    refetchQueries: [{ query: LIST_PROJECTS }],\n  });\n\n  const { data } = useQuery<Projects>(LIST_PROJECTS, {\n    fetchPolicy: 'cache-and-network',\n  });\n\n  useEffect(() => {\n    const projectList = data?.listProjects ?? [];\n    const users: ReceivedInvitation[] = [];\n\n    let flag = 0;\n    let roleVar = '';\n\n    projectList.forEach((project) => {\n      project.members.forEach((member) => {\n        if (member.user_id === userID && member.invitation === 'Pending') {\n          flag = 1;\n          roleVar = member.role;\n        }\n      });\n      if (flag === 1) {\n        project.members.forEach((member) => {\n          if (member.user_id !== userID && member.role === 'Owner') {\n            users.push({\n              projectID: project.id,\n              projectName: project.name,\n              role: roleVar,\n              user_id: member.user_id,\n              user_name: member.user_name,\n            });\n          }\n        });\n        flag = 0;\n      }\n    });\n    setRows([...users]);\n  }, [data]);\n\n  useQuery(ALL_USERS, {\n    onCompleted: (data) => {\n      setAllUsers([...data.users]);\n      setLoading(false);\n    },\n  });\n\n  return (\n    <div data-cy=\"receivedInvitationModal\">\n      {!loading ? (\n        <>\n          {rows.length > 0 ? (\n            rows.map((row) => (\n              <Paper className={classes.root} key={`${row}`}>\n                <div className={classes.avatarDiv}>\n                  <Avatar\n                    data-cy=\"avatar\"\n                    alt=\"User\"\n                    className={classes.avatarBackground}\n                    style={{ alignContent: 'right' }}\n                  >\n                    {userInitials(\n                      allUsers.filter((data) => {\n                        return row.user_id === data.id;\n                      })[0].username\n                    )}\n                  </Avatar>\n                  <div>\n                    <Typography className={classes.name}>\n                      {\n                        allUsers.filter((data) => {\n                          return row.user_id === data.id;\n                        })[0].username\n                      }\n                    </Typography>\n                    <Typography className={classes.email}>\n                      {t(\n                        'settings.teamingTab.invitation.receivedInvitation.inviteTextFirst'\n                      )}{' '}\n                      {row.role === 'Editor' ? 'an' : 'a'}{' '}\n                      <strong>{row.role}</strong>{' '}\n                      {t(\n                        'settings.teamingTab.invitation.receivedInvitation.inviteTextSecond'\n                      )}\n                    </Typography>\n                  </div>\n                </div>\n                <div className={classes.projectDiv}>\n                  <Typography className={classes.projectName}>\n                    {row.projectName}\n                  </Typography>\n                </div>\n                <div className={classes.buttonDiv}>\n                  <ButtonOutlined\n                    className={classes.butnOutline}\n                    onClick={() => {\n                      setAcceptDecline(row.user_id);\n                      declineInvite({\n                        variables: {\n                          member: {\n                            project_id: row.projectID,\n                            user_id: getUserId(),\n                            role: row.role,\n                          },\n                        },\n                      });\n                    }}\n                    disabled={false}\n                  >\n                    <div>\n                      {t(\n                        'settings.teamingTab.invitation.receivedInvitation.button.ignore'\n                      )}\n                    </div>\n                  </ButtonOutlined>\n                  <div data-cy=\"receivedInvitationAccept\">\n                    <ButtonFilled\n                      onClick={() => {\n                        setAcceptDecline(row.user_id);\n                        acceptInvite({\n                          variables: {\n                            member: {\n                              project_id: row.projectID,\n                              user_id: getUserId(),\n                              role: row.role,\n                            },\n                          },\n                        });\n                      }}\n                      disabled={false}\n                    >\n                      {t(\n                        'settings.teamingTab.invitation.receivedInvitation.button.accept'\n                      )}\n                    </ButtonFilled>\n                  </div>\n                </div>{' '}\n              </Paper>\n            ))\n          ) : (\n            <></>\n          )}\n        </>\n      ) : (\n        <></>\n      )}\n    </div>\n  );\n};\n\nexport default ReceivedInvitations;\n"]},"metadata":{},"sourceType":"module"}