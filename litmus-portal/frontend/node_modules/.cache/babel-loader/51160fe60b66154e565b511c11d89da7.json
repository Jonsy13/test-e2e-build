{"ast":null,"code":"import _slicedToArray from \"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/Settings/AccountsTab/PersonalDetails/index.tsx\";\n\nimport { useMutation, useQuery } from '@apollo/client';\nimport { Typography } from '@material-ui/core';\nimport { ButtonFilled, ButtonOutlined, Modal } from 'litmus-ui';\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Loader from '../../../../components/Loader';\nimport UserDetails from '../../../../components/UserDetails';\nimport config from '../../../../config';\nimport { GET_USER, UPDATE_DETAILS } from '../../../../graphql';\nimport { getToken, getUsername } from '../../../../utils/auth';\nimport useStyles from './styles';\n\n// Displays the personals details on the \"accounts\" tab\nvar PersonalDetails = function PersonalDetails() {\n  var _dataA$getUser$name, _dataA$getUser$email;\n\n  var classes = useStyles();\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var username = getUsername();\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      loading = _React$useState2[0],\n      setLoading = _React$useState2[1]; // Query to get user details\n\n\n  var _useQuery = useQuery(GET_USER, {\n    variables: {\n      username: username\n    }\n  }),\n      dataA = _useQuery.data;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      error = _useState2[0],\n      setError = _useState2[1];\n\n  var name = (_dataA$getUser$name = dataA === null || dataA === void 0 ? void 0 : dataA.getUser.name) !== null && _dataA$getUser$name !== void 0 ? _dataA$getUser$name : ''; // TODO: Check if can be replaced with JWT based data.\n\n  var email = (_dataA$getUser$email = dataA === null || dataA === void 0 ? void 0 : dataA.getUser.email) !== null && _dataA$getUser$email !== void 0 ? _dataA$getUser$email : '';\n\n  var _React$useState3 = React.useState({\n    email: email,\n    userName: username,\n    fullName: name\n  }),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      personaData = _React$useState4[0],\n      setPersonaData = _React$useState4[1]; // For closing and opening of the modal\n\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      open = _React$useState6[0],\n      setOpen = _React$useState6[1];\n\n  var handleClose = function handleClose() {\n    setOpen(false);\n  };\n\n  var handleUserChange = function handleUserChange(e) {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: e.target.value,\n      email: personaData.email\n    });\n  };\n\n  var handleNameChange = function handleNameChange(e) {\n    setPersonaData({\n      fullName: e.target.value,\n      userName: personaData.userName,\n      email: personaData.email\n    });\n  };\n\n  var handleEmailChange = function handleEmailChange(e) {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: personaData.userName,\n      email: e.target.value\n    });\n  };\n\n  var _useMutation = useMutation(UPDATE_DETAILS, {\n    onCompleted: function onCompleted() {\n      setLoading(false);\n      setOpen(true);\n    },\n    onError: function onError(error) {\n      setLoading(false);\n      setError(error.message);\n      setOpen(true);\n    },\n    refetchQueries: [{\n      query: GET_USER,\n      variables: {\n        username: username\n      }\n    }]\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      updateDetails = _useMutation2[0]; // Submit entered data to /update endpoint\n\n\n  var handleSubmit = function handleSubmit() {\n    setLoading(true);\n    fetch(\"\".concat(config.auth.url, \"/update/details\"), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: \"Bearer \".concat(getToken())\n      },\n      body: JSON.stringify({\n        username: username,\n        name: personaData.fullName,\n        email: personaData.email\n      })\n    }).then(function (response) {\n      return response.json();\n    }).then(function (data) {\n      if ('error' in data) {\n        setError(data.error_description);\n        setLoading(false);\n        setOpen(true);\n      } else {\n        updateDetails({\n          variables: {\n            user: {\n              id: dataA === null || dataA === void 0 ? void 0 : dataA.getUser.id,\n              name: personaData.fullName,\n              email: personaData.email\n            }\n          }\n        });\n      }\n    }).catch(function (err) {\n      setError(err.message);\n      setOpen(true);\n      setLoading(false);\n      console.error(err);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(UserDetails, {\n    nameValue: personaData.fullName,\n    isUsernameDisabled: true,\n    handleNameChange: handleNameChange,\n    emailValue: personaData.email,\n    handleEmailChange: handleEmailChange,\n    userValue: personaData.userName,\n    handleUserChange: handleUserChange,\n    isNameDisabled: false,\n    isEmailDisabled: false,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.saveButton,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    \"data-cy\": \"save\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(ButtonFilled, {\n    disabled: !(personaData.fullName.length && !loading),\n    onClick: handleSubmit,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 13\n    }\n  }, loading ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Loader, {\n    size: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 19\n    }\n  })) : /*#__PURE__*/React.createElement(React.Fragment, null, t('settings.accountsTab.personalDetails.button.saveChanges')))), /*#__PURE__*/React.createElement(Modal, {\n    open: open,\n    onClose: handleClose,\n    modalActions: /*#__PURE__*/React.createElement(ButtonOutlined, {\n      onClick: handleClose,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 15\n      }\n    }, \"\\u2715\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }\n  }, error.length ? /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.errDiv,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.textError,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.typo,\n    align: \"center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 21\n    }\n  }, t('settings.accountsTab.personalDetails.modal.headerErrStrong'), \":\"), ' ', t('settings.accountsTab.personalDetails.modal.headerErr'))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.textSecondError,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.typoSub,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 19\n    }\n  }, t('settings.accountsTab.personalDetails.modal.headerErrStrong'), \": \", error)), /*#__PURE__*/React.createElement(\"div\", {\n    \"data-cy\": \"done\",\n    className: classes.buttonModal,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ButtonFilled, {\n    onClick: handleClose,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, t('settings.accountsTab.personalDetails.button.done'))))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.body,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: \"./icons/userLarge.svg\",\n    alt: \"user\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.text,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.typo,\n    align: \"center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 19\n    }\n  }, t('settings.accountsTab.personalDetails.modal.header'), ' ', /*#__PURE__*/React.createElement(\"strong\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 21\n    }\n  }, t('settings.accountsTab.personalDetails.modal.headerStrong')))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.text1,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    align: \"center\",\n    className: classes.typo1,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 19\n    }\n  }, t('settings.accountsTab.personalDetails.modal.info'))), /*#__PURE__*/React.createElement(\"div\", {\n    \"data-cy\": \"done\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ButtonFilled, {\n    onClick: handleClose,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, t('settings.accountsTab.personalDetails.button.done')))))))));\n};\n\nexport default PersonalDetails;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/Settings/AccountsTab/PersonalDetails/index.tsx"],"names":["useMutation","useQuery","Typography","ButtonFilled","ButtonOutlined","Modal","React","useState","useTranslation","Loader","UserDetails","config","GET_USER","UPDATE_DETAILS","getToken","getUsername","useStyles","PersonalDetails","classes","t","username","loading","setLoading","variables","dataA","data","error","setError","name","getUser","email","userName","fullName","personaData","setPersonaData","open","setOpen","handleClose","handleUserChange","e","target","value","handleNameChange","handleEmailChange","onCompleted","onError","message","refetchQueries","query","updateDetails","handleSubmit","fetch","auth","url","method","headers","Authorization","body","JSON","stringify","then","response","json","error_description","user","id","catch","err","console","saveButton","length","errDiv","textError","typo","textSecondError","typoSub","buttonModal","text","text1","typo1"],"mappings":"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","sourcesContent":["import { useMutation, useQuery } from '@apollo/client';\nimport { Typography } from '@material-ui/core';\nimport { ButtonFilled, ButtonOutlined, Modal } from 'litmus-ui';\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Loader from '../../../../components/Loader';\nimport UserDetails from '../../../../components/UserDetails';\nimport config from '../../../../config';\nimport { GET_USER, UPDATE_DETAILS } from '../../../../graphql';\nimport {\n  CurrentUserDedtailsVars,\n  CurrentUserDetails,\n} from '../../../../models/graphql/user';\nimport { UpdateUser } from '../../../../models/userData';\nimport { getToken, getUsername } from '../../../../utils/auth';\nimport useStyles from './styles';\n\ninterface personaData {\n  email: string;\n  userName: string;\n  fullName: string;\n}\n\n// Displays the personals details on the \"accounts\" tab\nconst PersonalDetails: React.FC = () => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n\n  const username = getUsername();\n  const [loading, setLoading] = React.useState(false);\n  // Query to get user details\n  const { data: dataA } = useQuery<CurrentUserDetails, CurrentUserDedtailsVars>(\n    GET_USER,\n    { variables: { username } }\n  );\n  const [error, setError] = useState<string>('');\n  const name: string = dataA?.getUser.name ?? ''; // TODO: Check if can be replaced with JWT based data.\n  const email: string = dataA?.getUser.email ?? '';\n  const [personaData, setPersonaData] = React.useState<personaData>({\n    email,\n    userName: username,\n    fullName: name,\n  });\n  // For closing and opening of the modal\n  const [open, setOpen] = React.useState(false);\n  const handleClose = () => {\n    setOpen(false);\n  };\n  const handleUserChange = (e: any) => {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: e.target.value,\n      email: personaData.email,\n    });\n  };\n  const handleNameChange = (e: any) => {\n    setPersonaData({\n      fullName: e.target.value,\n      userName: personaData.userName,\n      email: personaData.email,\n    });\n  };\n  const handleEmailChange = (e: any) => {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: personaData.userName,\n      email: e.target.value,\n    });\n  };\n  const [updateDetails] = useMutation<UpdateUser>(UPDATE_DETAILS, {\n    onCompleted: () => {\n      setLoading(false);\n      setOpen(true);\n    },\n    onError: (error) => {\n      setLoading(false);\n      setError(error.message as string);\n      setOpen(true);\n    },\n    refetchQueries: [{ query: GET_USER, variables: { username } }],\n  });\n  // Submit entered data to /update endpoint\n  const handleSubmit = () => {\n    setLoading(true);\n    fetch(`${config.auth.url}/update/details`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${getToken()}`,\n      },\n      body: JSON.stringify({\n        username,\n        name: personaData.fullName,\n        email: personaData.email,\n      }),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        if ('error' in data) {\n          setError(data.error_description as string);\n          setLoading(false);\n          setOpen(true);\n        } else {\n          updateDetails({\n            variables: {\n              user: {\n                id: dataA?.getUser.id,\n                name: personaData.fullName,\n                email: personaData.email,\n              },\n            },\n          });\n        }\n      })\n      .catch((err) => {\n        setError(err.message as string);\n        setOpen(true);\n        setLoading(false);\n        console.error(err);\n      });\n  };\n  return (\n    <div>\n      <form>\n        <UserDetails\n          nameValue={personaData.fullName}\n          isUsernameDisabled\n          handleNameChange={handleNameChange}\n          emailValue={personaData.email}\n          handleEmailChange={handleEmailChange}\n          userValue={personaData.userName}\n          handleUserChange={handleUserChange}\n          isNameDisabled={false}\n          isEmailDisabled={false}\n        />\n        <div className={classes.saveButton}>\n          <div data-cy=\"save\">\n            <ButtonFilled\n              disabled={!(personaData.fullName.length && !loading)}\n              onClick={handleSubmit}\n            >\n              {loading ? (\n                <div>\n                  <Loader size={20} />\n                </div>\n              ) : (\n                <>\n                  {t('settings.accountsTab.personalDetails.button.saveChanges')}\n                </>\n              )}\n            </ButtonFilled>\n          </div>\n          <Modal\n            open={open}\n            onClose={handleClose}\n            modalActions={\n              <ButtonOutlined onClick={handleClose}>&#x2715;</ButtonOutlined>\n            }\n          >\n            {error.length ? (\n              <div className={classes.errDiv}>\n                <div className={classes.textError}>\n                  <Typography className={classes.typo} align=\"center\">\n                    <strong>\n                      {t(\n                        'settings.accountsTab.personalDetails.modal.headerErrStrong'\n                      )}\n                      :\n                    </strong>{' '}\n                    {t('settings.accountsTab.personalDetails.modal.headerErr')}\n                  </Typography>\n                </div>\n                <div className={classes.textSecondError}>\n                  <Typography className={classes.typoSub}>\n                    {t(\n                      'settings.accountsTab.personalDetails.modal.headerErrStrong'\n                    )}\n                    : {error}\n                  </Typography>\n                </div>\n                <div data-cy=\"done\" className={classes.buttonModal}>\n                  <ButtonFilled onClick={handleClose}>\n                    <>{t('settings.accountsTab.personalDetails.button.done')}</>\n                  </ButtonFilled>\n                </div>\n              </div>\n            ) : (\n              <div className={classes.body}>\n                <img src=\"./icons/userLarge.svg\" alt=\"user\" />\n                <div className={classes.text}>\n                  <Typography className={classes.typo} align=\"center\">\n                    {t('settings.accountsTab.personalDetails.modal.header')}{' '}\n                    <strong>\n                      {t(\n                        'settings.accountsTab.personalDetails.modal.headerStrong'\n                      )}\n                    </strong>\n                  </Typography>\n                </div>\n                <div className={classes.text1}>\n                  <Typography align=\"center\" className={classes.typo1}>\n                    {t('settings.accountsTab.personalDetails.modal.info')}\n                  </Typography>\n                </div>\n                <div data-cy=\"done\">\n                  <ButtonFilled onClick={handleClose}>\n                    <>{t('settings.accountsTab.personalDetails.button.done')}</>\n                  </ButtonFilled>\n                </div>\n              </div>\n            )}\n          </Modal>\n        </div>\n      </form>\n    </div>\n  );\n};\nexport default PersonalDetails;\n"]},"metadata":{},"sourceType":"module"}