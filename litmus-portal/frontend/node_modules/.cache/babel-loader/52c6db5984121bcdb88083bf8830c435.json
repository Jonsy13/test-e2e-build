{"ast":null,"code":"import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useMutation}from'@apollo/client';import{Typography}from'@material-ui/core';import{ButtonFilled,ButtonOutlined,Modal}from'litmus-ui';import React,{useEffect,useState}from'react';import{useTranslation}from'react-i18next';import{useSelector}from'react-redux';import BackButton from'../../components/Button/BackButton';import Scaffold from'../../containers/layouts/Scaffold';import{CREATE_DATASOURCE,UPDATE_DATASOURCE}from'../../graphql/mutations';import{history}from'../../redux/configureStore';import{ReactComponent as CrossMarkIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../../svg/crossmark.svg\";import{getProjectID,getProjectRole}from'../../utils/getSearchParams';import{isValidWebUrl,validateTimeInSeconds}from'../../utils/validate';import ConfigurePrometheus from'../../views/Analytics/DataSources/Forms/prometheus';import useStyles from'./styles';var DataSourceConfigurePage=function DataSourceConfigurePage(_ref){var configure=_ref.configure;var classes=useStyles();var _useTranslation=useTranslation(),t=_useTranslation.t;var dataSourceID=useSelector(function(state){return state.selectDataSource.selectedDataSourceID;});var selectedDataSourceName=useSelector(function(state){return state.selectDataSource.selectedDataSourceName;});var projectID=getProjectID();var projectRole=getProjectRole();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),open=_React$useState2[0],setOpen=_React$useState2[1];var _React$useState3=React.useState(true),_React$useState4=_slicedToArray(_React$useState3,2),disabled=_React$useState4[0],setDisabled=_React$useState4[1];var _React$useState5=React.useState(1),_React$useState6=_slicedToArray(_React$useState5,2),page=_React$useState6[0],setPage=_React$useState6[1];var _useState=useState({id:'',name:'',dataSourceType:'Prometheus',url:'http://localhost:9090',access:'Server (Default)',basicAuth:false,username:'',password:'',noAuth:true,withCredentials:false,tlsClientAuth:false,withCACert:false,scrapeInterval:'15s',queryTimeout:'30s',httpMethod:'POST'}),_useState2=_slicedToArray(_useState,2),dataSourceVars=_useState2[0],setDataSourceVars=_useState2[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),mutate=_React$useState8[0],setMutate=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),success=_React$useState10[0],setSuccess=_React$useState10[1];var _useMutation=useMutation(CREATE_DATASOURCE,{onCompleted:function onCompleted(){setSuccess(true);setMutate(false);setOpen(true);},onError:function onError(){setMutate(false);setOpen(true);}}),_useMutation2=_slicedToArray(_useMutation,1),createDataSource=_useMutation2[0];var _useMutation3=useMutation(UPDATE_DATASOURCE,{onCompleted:function onCompleted(){setSuccess(true);setMutate(false);setOpen(true);},onError:function onError(){setMutate(false);setOpen(true);}}),_useMutation4=_slicedToArray(_useMutation3,1),updateDataSource=_useMutation4[0];var handleCreateMutation=function handleCreateMutation(){var authType='no auth';if(dataSourceVars.noAuth===false&&dataSourceVars.basicAuth===true){authType='basic auth';}var dataSourceInput={ds_name:dataSourceVars.name,ds_type:dataSourceVars.dataSourceType,ds_url:dataSourceVars.url[dataSourceVars.url.length-1]!=='/'?dataSourceVars.url:dataSourceVars.url.slice(0,-1),access_type:dataSourceVars.access,auth_type:authType,basic_auth_username:dataSourceVars.username,basic_auth_password:dataSourceVars.password,scrape_interval:parseInt(dataSourceVars.scrapeInterval.split('s')[0],10),query_timeout:parseInt(dataSourceVars.queryTimeout.split('s')[0],10),http_method:dataSourceVars.httpMethod,project_id:projectID};createDataSource({variables:{DSInput:dataSourceInput}});};var handleUpdateMutation=function handleUpdateMutation(){var _dataSourceVars$id;var authType='no auth';if(dataSourceVars.noAuth===false&&dataSourceVars.basicAuth===true){authType='basic auth';}var dataSourceInput={ds_id:(_dataSourceVars$id=dataSourceVars.id)!==null&&_dataSourceVars$id!==void 0?_dataSourceVars$id:'',ds_name:dataSourceVars.name,ds_type:dataSourceVars.dataSourceType,ds_url:dataSourceVars.url[dataSourceVars.url.length-1]!=='/'?dataSourceVars.url:dataSourceVars.url.slice(0,-1),access_type:dataSourceVars.access,auth_type:authType,basic_auth_username:dataSourceVars.username,basic_auth_password:dataSourceVars.password,scrape_interval:parseInt(dataSourceVars.scrapeInterval.split('s')[0],10),query_timeout:parseInt(dataSourceVars.queryTimeout.split('s')[0],10),http_method:dataSourceVars.httpMethod,project_id:projectID};updateDataSource({variables:{DSInput:dataSourceInput}});};useEffect(function(){if(mutate===true&&configure===false){handleCreateMutation();}else if(mutate===true&&configure===true){handleUpdateMutation();}},[mutate]);useEffect(function(){if(dataSourceVars.name===''||!isValidWebUrl(dataSourceVars.url)||!validateTimeInSeconds(dataSourceVars.queryTimeout)||!validateTimeInSeconds(dataSourceVars.scrapeInterval)){setDisabled(true);}else{setDisabled(false);}},[dataSourceVars]);return/*#__PURE__*/React.createElement(Scaffold,null,/*#__PURE__*/React.createElement(\"div\",{className:classes.rootConfigure},configure===false?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:classes.backButton},/*#__PURE__*/React.createElement(BackButton,null)),/*#__PURE__*/React.createElement(Typography,{className:classes.heading},t('analyticsDashboard.dataSourceForm.headingAdd')),/*#__PURE__*/React.createElement(ConfigurePrometheus,{configure:configure,page:page,CallbackToSetVars:function CallbackToSetVars(vars){setDataSourceVars(vars);}})):/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:classes.backButton},/*#__PURE__*/React.createElement(BackButton,null)),/*#__PURE__*/React.createElement(Typography,{className:classes.heading},t('analyticsDashboard.dataSourceForm.headingConfigure'),\" /\",' ',selectedDataSourceName),dataSourceID?/*#__PURE__*/React.createElement(ConfigurePrometheus,{configure:configure,dataSourceID:dataSourceID,page:page,CallbackToSetVars:function CallbackToSetVars(vars){setDataSourceVars(vars);}}):/*#__PURE__*/React.createElement(\"div\",null)),/*#__PURE__*/React.createElement(\"div\",{className:classes.buttons},page===2&&/*#__PURE__*/React.createElement(ButtonOutlined,{onClick:function onClick(){return setPage(1);},disabled:false},/*#__PURE__*/React.createElement(Typography,null,t('analyticsDashboard.dataSourceForm.back'))),/*#__PURE__*/React.createElement(\"div\",{className:classes.saveButton},/*#__PURE__*/React.createElement(Typography,{className:classes.stepText},t('analyticsDashboard.dataSourceForm.step'),' ',/*#__PURE__*/React.createElement(\"strong\",null,page),' ',t('analyticsDashboard.dataSourceForm.of2')),/*#__PURE__*/React.createElement(ButtonFilled,{disabled:page===1&&dataSourceVars.name===''?true:page===2?disabled:false,onClick:function onClick(){return page===2&&!disabled?setMutate(true):setPage(2);}},/*#__PURE__*/React.createElement(Typography,null,page===2?\"\".concat(t('analyticsDashboard.dataSourceForm.saveChanges')):\"\".concat(t('analyticsDashboard.dataSourceForm.next'))))))),/*#__PURE__*/React.createElement(Modal,{open:open,onClose:function onClose(){return setOpen(false);},width:\"60%\",modalActions:/*#__PURE__*/React.createElement(ButtonOutlined,{className:classes.closeButton,onClick:function onClick(){return setOpen(false);}},\"\\u2715\")},/*#__PURE__*/React.createElement(\"div\",{className:classes.modal},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},success===true?/*#__PURE__*/React.createElement(\"img\",{src:\"/icons/finish.svg\",alt:\"success\",className:classes.icon}):/*#__PURE__*/React.createElement(CrossMarkIcon,{className:classes.icon})),/*#__PURE__*/React.createElement(Typography,{className:classes.modalHeading,align:\"center\",variant:\"h3\"},success===true&&configure===false?\"\".concat(t('analyticsDashboard.dataSourceForm.modalHeadingSuccessAdd')):success===true&&configure===true?\"\".concat(t('analyticsDashboard.dataSourceForm.modalHeadingSuccessConfigure')):\"\".concat(t('analyticsDashboard.dataSourceForm.modalHeadingFailed'))),/*#__PURE__*/React.createElement(Typography,{align:\"center\",variant:\"body1\",className:classes.modalBody},success===true&&configure===false?/*#__PURE__*/React.createElement(\"div\",null,t('analyticsDashboard.dataSourceForm.modalBodySuccessAdd')):success===true&&configure===true?/*#__PURE__*/React.createElement(\"div\",null,t('analyticsDashboard.dataSourceForm.modalBodySuccessConfigure')):/*#__PURE__*/React.createElement(\"div\",null,t('analyticsDashboard.dataSourceForm.modalBodyFailed'))),success===true?/*#__PURE__*/React.createElement(ButtonFilled,{variant:\"success\",onClick:function onClick(){history.push({pathname:'/analytics',search:\"?projectID=\".concat(projectID,\"&projectRole=\").concat(projectRole)});}},/*#__PURE__*/React.createElement(\"div\",null,t('analyticsDashboard.dataSourceForm.modalActionsBack'))):/*#__PURE__*/React.createElement(\"div\",{className:classes.flexButtons},/*#__PURE__*/React.createElement(ButtonOutlined,{onClick:function onClick(){setOpen(false);setMutate(true);},disabled:false},/*#__PURE__*/React.createElement(\"div\",null,t('analyticsDashboard.dataSourceForm.modalActionsTryAgain'))),/*#__PURE__*/React.createElement(ButtonFilled,{variant:\"error\",onClick:function onClick(){history.push({pathname:'/analytics',search:\"?projectID=\".concat(projectID,\"&projectRole=\").concat(projectRole)});}},/*#__PURE__*/React.createElement(\"div\",null,t('analyticsDashboard.dataSourceForm.modalActionsBack')))))));};export default DataSourceConfigurePage;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/pages/ConfigureDataSources/index.tsx"],"names":["useMutation","Typography","ButtonFilled","ButtonOutlined","Modal","React","useEffect","useState","useTranslation","useSelector","BackButton","Scaffold","CREATE_DATASOURCE","UPDATE_DATASOURCE","history","getProjectID","getProjectRole","isValidWebUrl","validateTimeInSeconds","ConfigurePrometheus","useStyles","DataSourceConfigurePage","configure","classes","t","dataSourceID","state","selectDataSource","selectedDataSourceID","selectedDataSourceName","projectID","projectRole","open","setOpen","disabled","setDisabled","page","setPage","id","name","dataSourceType","url","access","basicAuth","username","password","noAuth","withCredentials","tlsClientAuth","withCACert","scrapeInterval","queryTimeout","httpMethod","dataSourceVars","setDataSourceVars","mutate","setMutate","success","setSuccess","onCompleted","onError","createDataSource","updateDataSource","handleCreateMutation","authType","dataSourceInput","ds_name","ds_type","ds_url","length","slice","access_type","auth_type","basic_auth_username","basic_auth_password","scrape_interval","parseInt","split","query_timeout","http_method","project_id","variables","DSInput","handleUpdateMutation","ds_id","rootConfigure","backButton","heading","vars","buttons","saveButton","stepText","closeButton","modal","icon","modalHeading","modalBody","push","pathname","search","flexButtons"],"mappings":"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","sourcesContent":["import { useMutation } from '@apollo/client';\nimport { Typography } from '@material-ui/core';\nimport { ButtonFilled, ButtonOutlined, Modal } from 'litmus-ui';\nimport React, { useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useSelector } from 'react-redux';\nimport BackButton from '../../components/Button/BackButton';\nimport Scaffold from '../../containers/layouts/Scaffold';\nimport { CREATE_DATASOURCE, UPDATE_DATASOURCE } from '../../graphql/mutations';\nimport { DataSourceDetails } from '../../models/dataSourceData';\nimport {\n  CreateDataSourceInput,\n  ListDataSourceResponse,\n} from '../../models/graphql/dataSourceDetails';\nimport { history } from '../../redux/configureStore';\nimport { RootState } from '../../redux/reducers';\nimport { ReactComponent as CrossMarkIcon } from '../../svg/crossmark.svg';\nimport { getProjectID, getProjectRole } from '../../utils/getSearchParams';\nimport { isValidWebUrl, validateTimeInSeconds } from '../../utils/validate';\nimport ConfigurePrometheus from '../../views/Analytics/DataSources/Forms/prometheus';\nimport useStyles from './styles';\n\ninterface DataSourceConfigurePageProps {\n  configure: boolean;\n}\n\nconst DataSourceConfigurePage: React.FC<DataSourceConfigurePageProps> = ({\n  configure,\n}) => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n  const dataSourceID = useSelector(\n    (state: RootState) => state.selectDataSource.selectedDataSourceID\n  );\n  const selectedDataSourceName = useSelector(\n    (state: RootState) => state.selectDataSource.selectedDataSourceName\n  );\n  const projectID = getProjectID();\n  const projectRole = getProjectRole();\n  const [open, setOpen] = React.useState(false);\n  const [disabled, setDisabled] = React.useState(true);\n  const [page, setPage] = React.useState<number>(1);\n  const [dataSourceVars, setDataSourceVars] = useState<DataSourceDetails>({\n    id: '',\n    name: '',\n    dataSourceType: 'Prometheus',\n    url: 'http://localhost:9090',\n    access: 'Server (Default)',\n    basicAuth: false,\n    username: '',\n    password: '',\n    noAuth: true,\n    withCredentials: false,\n    tlsClientAuth: false,\n    withCACert: false,\n    scrapeInterval: '15s',\n    queryTimeout: '30s',\n    httpMethod: 'POST',\n  });\n  const [mutate, setMutate] = React.useState(false);\n  const [success, setSuccess] = React.useState(false);\n  const [createDataSource] = useMutation<\n    ListDataSourceResponse,\n    CreateDataSourceInput\n  >(CREATE_DATASOURCE, {\n    onCompleted: () => {\n      setSuccess(true);\n      setMutate(false);\n      setOpen(true);\n    },\n    onError: () => {\n      setMutate(false);\n      setOpen(true);\n    },\n  });\n  const [updateDataSource] = useMutation<\n    ListDataSourceResponse,\n    CreateDataSourceInput\n  >(UPDATE_DATASOURCE, {\n    onCompleted: () => {\n      setSuccess(true);\n      setMutate(false);\n      setOpen(true);\n    },\n    onError: () => {\n      setMutate(false);\n      setOpen(true);\n    },\n  });\n\n  const handleCreateMutation = () => {\n    let authType: string = 'no auth';\n    if (dataSourceVars.noAuth === false && dataSourceVars.basicAuth === true) {\n      authType = 'basic auth';\n    }\n    const dataSourceInput = {\n      ds_name: dataSourceVars.name,\n      ds_type: dataSourceVars.dataSourceType,\n      ds_url:\n        dataSourceVars.url[dataSourceVars.url.length - 1] !== '/'\n          ? dataSourceVars.url\n          : dataSourceVars.url.slice(0, -1),\n      access_type: dataSourceVars.access,\n      auth_type: authType,\n      basic_auth_username: dataSourceVars.username,\n      basic_auth_password: dataSourceVars.password,\n      scrape_interval: parseInt(\n        dataSourceVars.scrapeInterval.split('s')[0],\n        10\n      ),\n      query_timeout: parseInt(dataSourceVars.queryTimeout.split('s')[0], 10),\n      http_method: dataSourceVars.httpMethod,\n      project_id: projectID,\n    };\n    createDataSource({\n      variables: { DSInput: dataSourceInput },\n    });\n  };\n\n  const handleUpdateMutation = () => {\n    let authType: string = 'no auth';\n    if (dataSourceVars.noAuth === false && dataSourceVars.basicAuth === true) {\n      authType = 'basic auth';\n    }\n    const dataSourceInput = {\n      ds_id: dataSourceVars.id ?? '',\n      ds_name: dataSourceVars.name,\n      ds_type: dataSourceVars.dataSourceType,\n      ds_url:\n        dataSourceVars.url[dataSourceVars.url.length - 1] !== '/'\n          ? dataSourceVars.url\n          : dataSourceVars.url.slice(0, -1),\n      access_type: dataSourceVars.access,\n      auth_type: authType,\n      basic_auth_username: dataSourceVars.username,\n      basic_auth_password: dataSourceVars.password,\n      scrape_interval: parseInt(\n        dataSourceVars.scrapeInterval.split('s')[0],\n        10\n      ),\n      query_timeout: parseInt(dataSourceVars.queryTimeout.split('s')[0], 10),\n      http_method: dataSourceVars.httpMethod,\n      project_id: projectID,\n    };\n    updateDataSource({\n      variables: { DSInput: dataSourceInput },\n    });\n  };\n\n  useEffect(() => {\n    if (mutate === true && configure === false) {\n      handleCreateMutation();\n    } else if (mutate === true && configure === true) {\n      handleUpdateMutation();\n    }\n  }, [mutate]);\n\n  useEffect(() => {\n    if (\n      dataSourceVars.name === '' ||\n      !isValidWebUrl(dataSourceVars.url) ||\n      !validateTimeInSeconds(dataSourceVars.queryTimeout) ||\n      !validateTimeInSeconds(dataSourceVars.scrapeInterval)\n    ) {\n      setDisabled(true);\n    } else {\n      setDisabled(false);\n    }\n  }, [dataSourceVars]);\n\n  return (\n    <Scaffold>\n      <div className={classes.rootConfigure}>\n        {configure === false ? (\n          <div>\n            <div className={classes.backButton}>\n              <BackButton />\n            </div>\n            <Typography className={classes.heading}>\n              {t('analyticsDashboard.dataSourceForm.headingAdd')}\n            </Typography>\n            <ConfigurePrometheus\n              configure={configure}\n              page={page}\n              CallbackToSetVars={(vars: DataSourceDetails) => {\n                setDataSourceVars(vars);\n              }}\n            />\n          </div>\n        ) : (\n          <div>\n            <div className={classes.backButton}>\n              <BackButton />\n            </div>\n            <Typography className={classes.heading}>\n              {t('analyticsDashboard.dataSourceForm.headingConfigure')} /{' '}\n              {selectedDataSourceName}\n            </Typography>\n            {dataSourceID ? (\n              <ConfigurePrometheus\n                configure={configure}\n                dataSourceID={dataSourceID}\n                page={page}\n                CallbackToSetVars={(vars: DataSourceDetails) => {\n                  setDataSourceVars(vars);\n                }}\n              />\n            ) : (\n              <div />\n            )}\n          </div>\n        )}\n\n        <div className={classes.buttons}>\n          {page === 2 && (\n            <ButtonOutlined onClick={() => setPage(1)} disabled={false}>\n              <Typography>\n                {t('analyticsDashboard.dataSourceForm.back')}\n              </Typography>\n            </ButtonOutlined>\n          )}\n          <div className={classes.saveButton}>\n            <Typography className={classes.stepText}>\n              {t('analyticsDashboard.dataSourceForm.step')}{' '}\n              <strong>{page}</strong>{' '}\n              {t('analyticsDashboard.dataSourceForm.of2')}\n            </Typography>\n            <ButtonFilled\n              disabled={\n                page === 1 && dataSourceVars.name === ''\n                  ? true\n                  : page === 2\n                  ? disabled\n                  : false\n              }\n              onClick={() =>\n                page === 2 && !disabled ? setMutate(true) : setPage(2)\n              }\n            >\n              <Typography>\n                {page === 2\n                  ? `${t('analyticsDashboard.dataSourceForm.saveChanges')}`\n                  : `${t('analyticsDashboard.dataSourceForm.next')}`}\n              </Typography>\n            </ButtonFilled>\n          </div>\n        </div>\n      </div>\n      <Modal\n        open={open}\n        onClose={() => setOpen(false)}\n        width=\"60%\"\n        modalActions={\n          <ButtonOutlined\n            className={classes.closeButton}\n            onClick={() => setOpen(false)}\n          >\n            &#x2715;\n          </ButtonOutlined>\n        }\n      >\n        <div className={classes.modal}>\n          <Typography align=\"center\">\n            {success === true ? (\n              <img\n                src=\"/icons/finish.svg\"\n                alt=\"success\"\n                className={classes.icon}\n              />\n            ) : (\n              <CrossMarkIcon className={classes.icon} />\n            )}\n          </Typography>\n\n          <Typography\n            className={classes.modalHeading}\n            align=\"center\"\n            variant=\"h3\"\n          >\n            {success === true && configure === false\n              ? `${t(\n                  'analyticsDashboard.dataSourceForm.modalHeadingSuccessAdd'\n                )}`\n              : success === true && configure === true\n              ? `${t(\n                  'analyticsDashboard.dataSourceForm.modalHeadingSuccessConfigure'\n                )}`\n              : `${t('analyticsDashboard.dataSourceForm.modalHeadingFailed')}`}\n          </Typography>\n\n          <Typography\n            align=\"center\"\n            variant=\"body1\"\n            className={classes.modalBody}\n          >\n            {success === true && configure === false ? (\n              <div>\n                {t('analyticsDashboard.dataSourceForm.modalBodySuccessAdd')}\n              </div>\n            ) : success === true && configure === true ? (\n              <div>\n                {t(\n                  'analyticsDashboard.dataSourceForm.modalBodySuccessConfigure'\n                )}\n              </div>\n            ) : (\n              <div>\n                {t('analyticsDashboard.dataSourceForm.modalBodyFailed')}\n              </div>\n            )}\n          </Typography>\n\n          {success === true ? (\n            <ButtonFilled\n              variant=\"success\"\n              onClick={() => {\n                history.push({\n                  pathname: '/analytics',\n                  search: `?projectID=${projectID}&projectRole=${projectRole}`,\n                });\n              }}\n            >\n              <div>\n                {t('analyticsDashboard.dataSourceForm.modalActionsBack')}\n              </div>\n            </ButtonFilled>\n          ) : (\n            <div className={classes.flexButtons}>\n              <ButtonOutlined\n                onClick={() => {\n                  setOpen(false);\n                  setMutate(true);\n                }}\n                disabled={false}\n              >\n                <div>\n                  {t('analyticsDashboard.dataSourceForm.modalActionsTryAgain')}\n                </div>\n              </ButtonOutlined>\n\n              <ButtonFilled\n                variant=\"error\"\n                onClick={() => {\n                  history.push({\n                    pathname: '/analytics',\n                    search: `?projectID=${projectID}&projectRole=${projectRole}`,\n                  });\n                }}\n              >\n                <div>\n                  {t('analyticsDashboard.dataSourceForm.modalActionsBack')}\n                </div>\n              </ButtonFilled>\n            </div>\n          )}\n        </div>\n      </Modal>\n    </Scaffold>\n  );\n};\n\nexport default DataSourceConfigurePage;\n"]},"metadata":{},"sourceType":"module"}