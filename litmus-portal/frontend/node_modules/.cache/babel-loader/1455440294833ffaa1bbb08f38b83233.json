{"ast":null,"code":"import _objectSpread from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable no-unused-expressions */import{Table,TableBody,TableCell,TableContainer,TablePagination,TableRow,Typography,useTheme}from'@material-ui/core';import moment from'moment';import React,{useEffect,useState}from'react';import InfoTooltip from'../../../../components/InfoTooltip';import{sortAlphaAsc,sortAlphaDesc,sortNumAsc,sortNumDesc}from'../../../../utils/sort';import useStyles from'./styles';import TableData from'./TableData';import TableHeader from'./TableHeader';import TableToolBar from'./TableToolbar';var WorkflowDetailsTable=function WorkflowDetailsTable(_ref){var workflowRunDetails=_ref.workflowRunDetails,workflowID=_ref.workflowID,reloadAnalytics=_ref.reloadAnalytics;var classes=useStyles();var _useTheme=useTheme(),palette=_useTheme.palette;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),close=_useState2[0],setClose=_useState2[1];var _React$useState=React.useState({range:{startDate:'all',endDate:'all'},selectedTest:'All',sortData:{name:{sort:false,ascending:true},lastRun:{sort:true,ascending:false},testResult:{sort:false,ascending:true}},selectedTestResult:'All',searchTokens:['']}),_React$useState2=_slicedToArray(_React$useState,2),filter=_React$useState2[0],setFilter=_React$useState2[1];var _React$useState3=React.useState(0),_React$useState4=_slicedToArray(_React$useState3,2),page=_React$useState4[0],setPage=_React$useState4[1];var _React$useState5=React.useState(5),_React$useState6=_slicedToArray(_React$useState5,2),rowsPerPage=_React$useState6[0],setRowsPerPage=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),reload=_React$useState8[0],setReload=_React$useState8[1];var _React$useState9=React.useState(0),_React$useState10=_slicedToArray(_React$useState9,2),resilienceScore=_React$useState10[0],setResilienceScore=_React$useState10[1];var handleChangePage=function handleChangePage(event,newPage){setPage(newPage);};var handleChangeRowsPerPage=function handleChangeRowsPerPage(event){setRowsPerPage(parseInt(event.target.value,10));setPage(0);};var getTests=function getTests(searchingData){var uniqueList=[];searchingData.forEach(function(data){if(!uniqueList.includes(data.test_name)){uniqueList.push(data.test_name);}});return uniqueList;};var getTestResults=function getTestResults(searchingData){var uniqueList=[];searchingData.forEach(function(data){if(!uniqueList.includes(data.test_result)){uniqueList.push(data.test_result);}});return uniqueList;};useEffect(function(){var totalWeight=0;var weightedSum=0;workflowRunDetails.forEach(function(test){if(test.test_result==='Pass'||test.test_result==='Fail'){totalWeight+=test.test_weight;weightedSum+=test.resulting_points;}});setResilienceScore(parseFloat((weightedSum/totalWeight*100).toFixed(2)));setReload(true);},[workflowID,reload]);var payload=workflowRunDetails.filter(function(wkf){return filter.searchTokens.every(function(s){return wkf.test_name.toLowerCase().includes(s)||(wkf.test_result!==undefined?wkf.test_result.toLowerCase().includes(s):false);});}).filter(function(data){return filter.selectedTest==='All'?true:data.test_name===filter.selectedTest;}).filter(function(data){return filter.selectedTestResult==='All'?true:data.test_result===filter.selectedTestResult;}).filter(function(data){return filter.range.startDate==='all'||filter.range.startDate&&filter.range.endDate===undefined?true:parseInt(data.last_run,10)*1000>=new Date(moment(filter.range.startDate).format()).getTime()&&parseInt(data.last_run,10)*1000<=new Date(new Date(moment(filter.range.endDate).format()).setHours(23,59,59)).getTime();}).sort(function(a,b){// Sorting based on unique fields\nif(filter.sortData.name.sort){var x=a.test_name;var y=b.test_name;return filter.sortData.name.ascending?sortAlphaAsc(x,y):sortAlphaDesc(x,y);}if(filter.sortData.lastRun.sort){var _x=parseInt(a.last_run,10);var _y=parseInt(b.last_run,10);return filter.sortData.lastRun.ascending?sortNumAsc(_y,_x):sortNumDesc(_y,_x);}if(filter.sortData.testResult.sort){var _x2=a.test_result;var _y2=b.test_result;return filter.sortData.testResult.ascending?sortAlphaAsc(_x2,_y2):sortAlphaDesc(_x2,_y2);}return 0;});var emptyRows=rowsPerPage-Math.min(rowsPerPage,payload.length-page*rowsPerPage);return/*#__PURE__*/React.createElement(\"div\",null,close?/*#__PURE__*/React.createElement(\"div\",null):/*#__PURE__*/React.createElement(\"div\",{className:classes.root},/*#__PURE__*/React.createElement(\"div\",{className:classes.tableFix},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"section\",{className:\"Heading section\"},/*#__PURE__*/React.createElement(TableToolBar,{searchToken:filter.searchTokens[0],handleSearch:function handleSearch(event,token){return setFilter(_objectSpread(_objectSpread({},filter),{},{searchTokens:(event!==undefined?event.target.value:token||'').toLowerCase().split(' ').filter(function(s){return s!=='';})}));},tests:getTests(payload),testResults:getTestResults(payload),callbackToSetTest:function callbackToSetTest(testName){setFilter(_objectSpread(_objectSpread({},filter),{},{selectedTest:testName}));},callbackToSetResult:function callbackToSetResult(testResult){setFilter(_objectSpread(_objectSpread({},filter),{},{selectedTestResult:testResult}));},callbackToSetRange:function callbackToSetRange(selectedStartDate,selectedEndDate){setFilter(_objectSpread(_objectSpread({},filter),{},{range:{startDate:selectedStartDate,endDate:selectedEndDate}}));}})),/*#__PURE__*/React.createElement(\"section\",{className:\"table section\"},/*#__PURE__*/React.createElement(TableContainer,{className:classes.tableMain},/*#__PURE__*/React.createElement(Table,{\"aria-label\":\"simple table\"},/*#__PURE__*/React.createElement(TableHeader,{callBackToSort:function callBackToSort(sortConfigurations){setFilter(_objectSpread(_objectSpread({},filter),{},{sortData:sortConfigurations}));},callBackToClose:function callBackToClose(close){setClose(close);reloadAnalytics();}}),/*#__PURE__*/React.createElement(TableBody,null,!workflowRunDetails.length?/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{colSpan:6},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},\"Unable to fetch data\"))):payload.length?payload.slice(0).slice(page*rowsPerPage,page*rowsPerPage+rowsPerPage).map(function(data){return/*#__PURE__*/React.createElement(TableRow,{hover:true,tabIndex:-1,key:data.test_id},/*#__PURE__*/React.createElement(TableData,{data:data}));}):/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{colSpan:6},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},\"No records available\"))),emptyRows>0&&/*#__PURE__*/React.createElement(TableRow,{style:{height:75*emptyRows}},/*#__PURE__*/React.createElement(TableCell,{colSpan:6}))))),/*#__PURE__*/React.createElement(\"div\",{className:classes.paginationArea},/*#__PURE__*/React.createElement(\"div\",{className:classes.toolTipGroup},/*#__PURE__*/React.createElement(Typography,{className:classes.resultText,display:\"inline\"},\"Resilience Score\",' ',/*#__PURE__*/React.createElement(InfoTooltip,{value:\"Resilience Score is the weighted average of all tests in the workflow.\"})),/*#__PURE__*/React.createElement(Typography,{className:classes.reliabilityScore,display:\"inline\"},resilienceScore<30?/*#__PURE__*/React.createElement(\"strong\",{style:{color:\"\".concat(palette.error.dark)}},resilienceScore,\"%\"):resilienceScore>30&&resilienceScore<=60?/*#__PURE__*/React.createElement(\"strong\",{style:{color:\"\".concat(palette.warning.main)}},resilienceScore,\"%\"):resilienceScore>60?/*#__PURE__*/React.createElement(\"strong\",{style:{color:\"\".concat(palette.secondary.dark)}},resilienceScore,\"%\"):/*#__PURE__*/React.createElement(\"strong\",{style:{color:\"\".concat(palette.error.dark)}},resilienceScore,\"%\"))),/*#__PURE__*/React.createElement(TablePagination,{rowsPerPageOptions:[5,10,25,50],component:\"div\",count:payload.length,rowsPerPage:rowsPerPage,page:page,onChangePage:handleChangePage,onChangeRowsPerPage:handleChangeRowsPerPage,className:classes.pagination})))))));};export default WorkflowDetailsTable;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/Analytics/WorkflowDashboard/WorkflowRunDetailsTable/index.tsx"],"names":["Table","TableBody","TableCell","TableContainer","TablePagination","TableRow","Typography","useTheme","moment","React","useEffect","useState","InfoTooltip","sortAlphaAsc","sortAlphaDesc","sortNumAsc","sortNumDesc","useStyles","TableData","TableHeader","TableToolBar","WorkflowDetailsTable","workflowRunDetails","workflowID","reloadAnalytics","classes","palette","close","setClose","range","startDate","endDate","selectedTest","sortData","name","sort","ascending","lastRun","testResult","selectedTestResult","searchTokens","filter","setFilter","page","setPage","rowsPerPage","setRowsPerPage","reload","setReload","resilienceScore","setResilienceScore","handleChangePage","event","newPage","handleChangeRowsPerPage","parseInt","target","value","getTests","searchingData","uniqueList","forEach","data","includes","test_name","push","getTestResults","test_result","totalWeight","weightedSum","test","test_weight","resulting_points","parseFloat","toFixed","payload","wkf","every","s","toLowerCase","undefined","last_run","Date","format","getTime","setHours","a","b","x","y","emptyRows","Math","min","length","root","tableFix","token","split","testName","selectedStartDate","selectedEndDate","tableMain","sortConfigurations","slice","map","test_id","height","paginationArea","toolTipGroup","resultText","reliabilityScore","color","error","dark","warning","main","secondary","pagination"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-expressions */\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TablePagination,\n  TableRow,\n  Typography,\n  useTheme,\n} from '@material-ui/core';\nimport moment from 'moment';\nimport React, { useEffect, useState } from 'react';\nimport InfoTooltip from '../../../../components/InfoTooltip';\nimport {\n  sortAlphaAsc,\n  sortAlphaDesc,\n  sortNumAsc,\n  sortNumDesc,\n} from '../../../../utils/sort';\nimport useStyles from './styles';\nimport TableData from './TableData';\nimport TableHeader from './TableHeader';\nimport TableToolBar from './TableToolbar';\n\ninterface RangeType {\n  startDate: string;\n  endDate: string;\n}\n\ninterface workFlowTests {\n  test_id: number;\n  test_name: string;\n  test_result: string;\n  test_weight: number;\n  resulting_points: number;\n  last_run: string;\n}\n\ninterface SortData {\n  lastRun: { sort: boolean; ascending: boolean };\n  name: { sort: boolean; ascending: boolean };\n  testResult: { sort: boolean; ascending: boolean };\n}\n\ninterface Filter {\n  range: RangeType;\n  selectedTest: string;\n  sortData: SortData;\n  selectedTestResult: string;\n  searchTokens: string[];\n}\n\ninterface ReloadAnalyticsType {\n  (): void;\n}\n\ninterface WorkflowRunDetailsTableProps {\n  workflowRunDetails: workFlowTests[];\n  workflowID: string;\n  reloadAnalytics: ReloadAnalyticsType;\n}\n\nconst WorkflowDetailsTable: React.FC<WorkflowRunDetailsTableProps> = ({\n  workflowRunDetails,\n  workflowID,\n  reloadAnalytics,\n}) => {\n  const classes = useStyles();\n  const { palette } = useTheme();\n  const [close, setClose] = useState<boolean>(false);\n  const [filter, setFilter] = React.useState<Filter>({\n    range: { startDate: 'all', endDate: 'all' },\n    selectedTest: 'All',\n    sortData: {\n      name: { sort: false, ascending: true },\n      lastRun: { sort: true, ascending: false },\n      testResult: { sort: false, ascending: true },\n    },\n    selectedTestResult: 'All',\n    searchTokens: [''],\n  });\n  const [page, setPage] = React.useState(0);\n  const [rowsPerPage, setRowsPerPage] = React.useState(5);\n  const [reload, setReload] = React.useState<boolean>(false);\n  const [resilienceScore, setResilienceScore] = React.useState<number>(0);\n\n  const handleChangePage = (event: unknown, newPage: number) => {\n    setPage(newPage);\n  };\n\n  const handleChangeRowsPerPage = (\n    event: React.ChangeEvent<HTMLInputElement>\n  ) => {\n    setRowsPerPage(parseInt(event.target.value, 10));\n    setPage(0);\n  };\n\n  const getTests = (searchingData: workFlowTests[]) => {\n    const uniqueList: string[] = [];\n    searchingData.forEach((data) => {\n      if (!uniqueList.includes(data.test_name)) {\n        uniqueList.push(data.test_name);\n      }\n    });\n    return uniqueList;\n  };\n\n  const getTestResults = (searchingData: workFlowTests[]) => {\n    const uniqueList: string[] = [];\n    searchingData.forEach((data) => {\n      if (!uniqueList.includes(data.test_result)) {\n        uniqueList.push(data.test_result);\n      }\n    });\n    return uniqueList;\n  };\n\n  useEffect(() => {\n    let totalWeight: number = 0;\n    let weightedSum: number = 0;\n    workflowRunDetails.forEach((test) => {\n      if (test.test_result === 'Pass' || test.test_result === 'Fail') {\n        totalWeight += test.test_weight;\n        weightedSum += test.resulting_points;\n      }\n    });\n    setResilienceScore(\n      parseFloat(((weightedSum / totalWeight) * 100).toFixed(2))\n    );\n    setReload(true);\n  }, [workflowID, reload]);\n\n  const payload: workFlowTests[] = workflowRunDetails\n    .filter((wkf: workFlowTests) => {\n      return filter.searchTokens.every(\n        (s: string) =>\n          wkf.test_name.toLowerCase().includes(s) ||\n          (wkf.test_result !== undefined\n            ? wkf.test_result.toLowerCase().includes(s)\n            : false)\n      );\n    })\n    .filter((data) => {\n      return filter.selectedTest === 'All'\n        ? true\n        : data.test_name === filter.selectedTest;\n    })\n    .filter((data) => {\n      return filter.selectedTestResult === 'All'\n        ? true\n        : data.test_result === filter.selectedTestResult;\n    })\n    .filter((data) => {\n      return filter.range.startDate === 'all' ||\n        (filter.range.startDate && filter.range.endDate === undefined)\n        ? true\n        : parseInt(data.last_run, 10) * 1000 >=\n            new Date(moment(filter.range.startDate).format()).getTime() &&\n            parseInt(data.last_run, 10) * 1000 <=\n              new Date(\n                new Date(moment(filter.range.endDate).format()).setHours(\n                  23,\n                  59,\n                  59\n                )\n              ).getTime();\n    })\n    .sort((a: workFlowTests, b: workFlowTests) => {\n      // Sorting based on unique fields\n      if (filter.sortData.name.sort) {\n        const x = a.test_name;\n        const y = b.test_name;\n\n        return filter.sortData.name.ascending\n          ? sortAlphaAsc(x, y)\n          : sortAlphaDesc(x, y);\n      }\n      if (filter.sortData.lastRun.sort) {\n        const x = parseInt(a.last_run, 10);\n\n        const y = parseInt(b.last_run, 10);\n\n        return filter.sortData.lastRun.ascending\n          ? sortNumAsc(y, x)\n          : sortNumDesc(y, x);\n      }\n      if (filter.sortData.testResult.sort) {\n        const x = a.test_result;\n        const y = b.test_result;\n\n        return filter.sortData.testResult.ascending\n          ? sortAlphaAsc(x, y)\n          : sortAlphaDesc(x, y);\n      }\n      return 0;\n    });\n\n  const emptyRows =\n    rowsPerPage - Math.min(rowsPerPage, payload.length - page * rowsPerPage);\n\n  return (\n    <div>\n      {close ? (\n        <div />\n      ) : (\n        <div className={classes.root}>\n          <div className={classes.tableFix}>\n            <div>\n              <section className=\"Heading section\">\n                <TableToolBar\n                  searchToken={filter.searchTokens[0]}\n                  handleSearch={(\n                    event: React.ChangeEvent<{ value: unknown }> | undefined,\n                    token: string | undefined\n                  ) =>\n                    setFilter({\n                      ...filter,\n                      searchTokens: (event !== undefined\n                        ? ((event.target as HTMLInputElement).value as string)\n                        : token || ''\n                      )\n                        .toLowerCase()\n                        .split(' ')\n                        .filter((s) => s !== ''),\n                    })\n                  }\n                  tests={getTests(payload)}\n                  testResults={getTestResults(payload)}\n                  callbackToSetTest={(testName: string) => {\n                    setFilter({\n                      ...filter,\n                      selectedTest: testName,\n                    });\n                  }}\n                  callbackToSetResult={(testResult: string) => {\n                    setFilter({\n                      ...filter,\n                      selectedTestResult: testResult,\n                    });\n                  }}\n                  callbackToSetRange={(\n                    selectedStartDate: string,\n                    selectedEndDate: string\n                  ) => {\n                    setFilter({\n                      ...filter,\n                      range: {\n                        startDate: selectedStartDate,\n                        endDate: selectedEndDate,\n                      },\n                    });\n                  }}\n                />\n              </section>\n              <section className=\"table section\">\n                <TableContainer className={classes.tableMain}>\n                  <Table aria-label=\"simple table\">\n                    <TableHeader\n                      callBackToSort={(sortConfigurations: SortData) => {\n                        setFilter({\n                          ...filter,\n                          sortData: sortConfigurations,\n                        });\n                      }}\n                      callBackToClose={(close: boolean) => {\n                        setClose(close);\n                        reloadAnalytics();\n                      }}\n                    />\n                    <TableBody>\n                      {!workflowRunDetails.length ? (\n                        <TableRow>\n                          <TableCell colSpan={6}>\n                            <Typography align=\"center\">\n                              Unable to fetch data\n                            </Typography>\n                          </TableCell>\n                        </TableRow>\n                      ) : payload.length ? (\n                        payload\n                          .slice(0)\n                          .slice(\n                            page * rowsPerPage,\n                            page * rowsPerPage + rowsPerPage\n                          )\n                          .map((data: workFlowTests) => {\n                            return (\n                              <TableRow hover tabIndex={-1} key={data.test_id}>\n                                <TableData data={data} />\n                              </TableRow>\n                            );\n                          })\n                      ) : (\n                        <TableRow>\n                          <TableCell colSpan={6}>\n                            <Typography align=\"center\">\n                              No records available\n                            </Typography>\n                          </TableCell>\n                        </TableRow>\n                      )}\n                      {emptyRows > 0 && (\n                        <TableRow style={{ height: 75 * emptyRows }}>\n                          <TableCell colSpan={6} />\n                        </TableRow>\n                      )}\n                    </TableBody>\n                  </Table>\n                </TableContainer>\n                <div className={classes.paginationArea}>\n                  <div className={classes.toolTipGroup}>\n                    <Typography className={classes.resultText} display=\"inline\">\n                      Resilience Score{' '}\n                      <InfoTooltip value=\"Resilience Score is the weighted average of all tests in the workflow.\" />\n                    </Typography>\n                    <Typography\n                      className={classes.reliabilityScore}\n                      display=\"inline\"\n                    >\n                      {resilienceScore < 30 ? (\n                        <strong style={{ color: `${palette.error.dark}` }}>\n                          {resilienceScore}%\n                        </strong>\n                      ) : resilienceScore > 30 && resilienceScore <= 60 ? (\n                        <strong style={{ color: `${palette.warning.main}` }}>\n                          {resilienceScore}%\n                        </strong>\n                      ) : resilienceScore > 60 ? (\n                        <strong style={{ color: `${palette.secondary.dark}` }}>\n                          {resilienceScore}%\n                        </strong>\n                      ) : (\n                        <strong style={{ color: `${palette.error.dark}` }}>\n                          {resilienceScore}%\n                        </strong>\n                      )}\n                    </Typography>\n                  </div>\n\n                  <TablePagination\n                    rowsPerPageOptions={[5, 10, 25, 50]}\n                    component=\"div\"\n                    count={payload.length}\n                    rowsPerPage={rowsPerPage}\n                    page={page}\n                    onChangePage={handleChangePage}\n                    onChangeRowsPerPage={handleChangeRowsPerPage}\n                    className={classes.pagination}\n                  />\n                </div>\n              </section>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default WorkflowDetailsTable;\n"]},"metadata":{},"sourceType":"module"}