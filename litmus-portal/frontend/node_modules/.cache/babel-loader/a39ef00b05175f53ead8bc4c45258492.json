{"ast":null,"code":"import _toConsumableArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable no-unused-expressions */import{useMutation,useQuery}from'@apollo/client/react';import{Input,InputAdornment,Table,TableCell,TableContainer,TableRow,Toolbar,Typography,useTheme}from'@material-ui/core';import{ButtonFilled}from'litmus-ui';import React,{useState}from'react';import{useTranslation}from'react-i18next';import Loader from'../../../../../components/Loader';import{ALL_USERS,GET_PROJECT,SEND_INVITE}from'../../../../../graphql';import{getProjectID}from'../../../../../utils/getSearchParams';import useStyles from'./styles';import TableData from'./TableData';var Invite=function Invite(_ref){var handleModal=_ref.handleModal;var classes=useStyles();var theme=useTheme();var _useTranslation=useTranslation(),t=_useTranslation.t;// for response data\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),rows=_useState2[0],setRows=_useState2[1];var projectID=getProjectID();// for setting the role of the user while sending invitation\nvar _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),roles=_useState4[0],setRoles=_useState4[1];// Array to store the list of selected users to be invited\nvar _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),selected=_React$useState2[0],setSelected=_React$useState2[1];// Sets the user role while inviting\nvar setUserRole=function setUserRole(user_uid,role){setSelected(selected.map(function(r){return r.user_id===user_uid?_objectSpread(_objectSpread({},r),{},{role:role}):r;}));if(roles.find(function(ele){return ele.user_uid===user_uid;})){setRoles(roles.map(function(r){return r.user_uid===user_uid?{user_uid:user_uid,role:role}:r;}));}else{setRoles([].concat(_toConsumableArray(roles),[{user_uid:user_uid,role:role}]));}};var _useQuery=useQuery(GET_PROJECT,{variables:{projectID:projectID},fetchPolicy:'cache-and-network'}),loading=_useQuery.loading,dataB=_useQuery.data;useQuery(ALL_USERS,{skip:!dataB,onCompleted:function onCompleted(data){var memberList=new Map();var users=[];if(dataB!==undefined){dataB.getProject.members.forEach(function(member){if(member.invitation==='Accepted'||member.invitation==='Pending'){memberList.set(member.user_id,1);}});// check for displaying only those users who are not the part of team\ndata&&data.users.forEach(function(user){if(!memberList.has(user.id))users.push(user);});setRows([].concat(users));}}});// mutation to send invitation to selected users\nvar _useMutation=useMutation(SEND_INVITE,{refetchQueries:[{query:GET_PROJECT,variables:{projectID:projectID}}]}),_useMutation2=_slicedToArray(_useMutation,2),SendInvite=_useMutation2[0],_useMutation2$=_useMutation2[1],errorB=_useMutation2$.error,loadingB=_useMutation2$.loading;// Checks if the user the already selected or not\nvar isSelected=function isSelected(user){var user_uids=new Map();selected.map(function(el){return user_uids.set(el.user_id,el.role);});return user_uids.has(user.id);};var handleClick=function handleClick(event,selectedUser){var selectedIds=selected.map(function(el){return el.user_id;});var isUserAlreadySelected=selectedIds.indexOf(selectedUser.id);var newSelected=[];if(isUserAlreadySelected===-1){var userrole=function userrole(){var r=roles.find(function(ele){return ele.user_uid===selectedUser.id;});if(r){return r.role;}return'Viewer';};newSelected=newSelected.concat(selected,{user_name:selectedUser.username,user_id:selectedUser.id,role:userrole()});}else if(isUserAlreadySelected===0){newSelected=newSelected.concat(selected.slice(1));}else if(isUserAlreadySelected===selected.length-1){newSelected=newSelected.concat(selected.slice(0,-1));}else if(isUserAlreadySelected>0){newSelected=newSelected.concat(selected.slice(0,isUserAlreadySelected),selected.slice(isUserAlreadySelected+1));}setSelected(newSelected);};// States for filters\nvar _useState5=useState({search:''}),_useState6=_slicedToArray(_useState5,2),filters=_useState6[0],setFilters=_useState6[1];var filteredData=!loading?rows.filter(function(dataRow){return dataRow.username.toLowerCase().includes(filters.search.toLowerCase());}):[];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showsuccess=_useState8[0],setShowsuccess=_useState8[1];return/*#__PURE__*/React.createElement(\"div\",null,showsuccess?/*#__PURE__*/React.createElement(React.Fragment,null,loadingB?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Loader,null)):/*#__PURE__*/React.createElement(Typography,null,errorB?/*#__PURE__*/React.createElement(Typography,null,errorB.message):/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"inviteNewMemberSuccessModal\",className:classes.body},/*#__PURE__*/React.createElement(\"img\",{src:\"./icons/checkmark.svg\",alt:\"checkmark\"}),/*#__PURE__*/React.createElement(\"div\",{className:classes.text},/*#__PURE__*/React.createElement(Typography,{className:classes.typo},t('settings.teamingTab.inviteNew.invite.successHeader'),' ',/*#__PURE__*/React.createElement(\"strong\",null,t('settings.teamingTab.inviteNew.invite.successHeaderStrong')))),/*#__PURE__*/React.createElement(\"div\",{className:classes.textSecond},/*#__PURE__*/React.createElement(Typography,{className:classes.typoSub},t('settings.teamingTab.inviteNew.invite.info'))),/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"inviteNewMemberSuccessModalDoneButton\",className:classes.buttonModal},/*#__PURE__*/React.createElement(ButtonFilled,{onClick:handleModal},/*#__PURE__*/React.createElement(React.Fragment,null,t('settings.teamingTab.inviteNew.invite.button.done'))))))):/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Typography,{className:classes.Header},t('settings.teamingTab.inviteNew.invite.header'),' ',/*#__PURE__*/React.createElement(\"strong\",null,t('settings.teamingTab.inviteNew.invite.headerStrong'))),/*#__PURE__*/React.createElement(Toolbar,{className:classes.toolbar},/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"inviteNewMemberSearch\",className:classes.inviteSomeone},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Input,{id:\"input-with-icon-textfield\",placeholder:t('settings.teamingTab.inviteNew.invite.label.someone'),onChange:function onChange(e){setFilters({search:e.target.value});},startAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"start\"},/*#__PURE__*/React.createElement(\"img\",{src:\"./icons/user-invite.svg\",alt:\"user\"})),disableUnderline:true,inputProps:{className:classes.input,style:{color:theme.palette.text.primary}}})),/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"inviteNewMemberSendInviteButton\"},/*#__PURE__*/React.createElement(ButtonFilled,{disabled:!selected.length,onClick:function onClick(){setShowsuccess(true);selected.map(function(s){return!errorB&&!loadingB&&SendInvite({variables:{member:{project_id:projectID,user_id:s.user_id,role:s.role}}});});}},/*#__PURE__*/React.createElement(\"div\",null,t('settings.teamingTab.inviteNew.invite.button.send')))))),/*#__PURE__*/React.createElement(TableContainer,{\"data-cy\":\"inviteNewMemberTable\",className:classes.table},/*#__PURE__*/React.createElement(Table,{stickyHeader:true,\"aria-label\":\"sticky table\"},filteredData&&filteredData.length>0?filteredData.map(function(row,index){var isItemSelected=isSelected(row);var labelId=\"enhanced-table-checkbox-\".concat(index);return/*#__PURE__*/React.createElement(TableRow,{\"data-cy\":\"inviteNewMemberCheckBox\",role:\"checkbox\",key:row.id,\"aria-checked\":isItemSelected,selected:isItemSelected},/*#__PURE__*/React.createElement(TableData,{row:row,isItemSelected:isItemSelected,handleCheck:handleClick,labelId:labelId,sendInvite:setUserRole}));}):/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{colSpan:2,className:classes.tableCell},/*#__PURE__*/React.createElement(Typography,{align:\"center\"},t('settings.teamingTab.inviteNew.invite.noUsers'))))))));};export default Invite;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/Settings/TeamingTab/InviteNew/Invite/index.tsx"],"names":["useMutation","useQuery","Input","InputAdornment","Table","TableCell","TableContainer","TableRow","Toolbar","Typography","useTheme","ButtonFilled","React","useState","useTranslation","Loader","ALL_USERS","GET_PROJECT","SEND_INVITE","getProjectID","useStyles","TableData","Invite","handleModal","classes","theme","t","rows","setRows","projectID","roles","setRoles","selected","setSelected","setUserRole","user_uid","role","map","r","user_id","find","ele","variables","fetchPolicy","loading","dataB","data","skip","onCompleted","memberList","Map","users","undefined","getProject","members","forEach","member","invitation","set","user","has","id","push","refetchQueries","query","SendInvite","errorB","error","loadingB","isSelected","user_uids","el","handleClick","event","selectedUser","selectedIds","isUserAlreadySelected","indexOf","newSelected","userrole","concat","user_name","username","slice","length","search","filters","setFilters","filteredData","filter","dataRow","toLowerCase","includes","showsuccess","setShowsuccess","message","body","text","typo","textSecond","typoSub","buttonModal","Header","toolbar","inviteSomeone","e","target","value","className","input","style","color","palette","primary","s","project_id","table","row","index","isItemSelected","labelId","tableCell"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-expressions */\nimport { useMutation, useQuery } from '@apollo/client/react';\nimport {\n  Input,\n  InputAdornment,\n  Table,\n  TableCell,\n  TableContainer,\n  TableRow,\n  Toolbar,\n  Typography,\n  useTheme,\n} from '@material-ui/core';\nimport { ButtonFilled } from 'litmus-ui';\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Loader from '../../../../../components/Loader';\nimport { ALL_USERS, GET_PROJECT, SEND_INVITE } from '../../../../../graphql';\nimport {\n  MemberInviteNew,\n  UserInvite,\n} from '../../../../../models/graphql/invite';\nimport {\n  ProjectDetail,\n  ProjectDetailVars,\n} from '../../../../../models/graphql/user';\nimport { getProjectID } from '../../../../../utils/getSearchParams';\nimport useStyles from './styles';\nimport TableData from './TableData';\n\ninterface FilterOptions {\n  search: string;\n}\n\ninterface InviteProps {\n  handleModal: () => void;\n}\n\ninterface SelectedUser {\n  user_name: string;\n  user_id: string;\n  role: string;\n}\n\ninterface Role {\n  user_uid: string;\n  role: string;\n}\n\nconst Invite: React.FC<InviteProps> = ({ handleModal }) => {\n  const classes = useStyles();\n  const theme = useTheme();\n  const { t } = useTranslation();\n\n  // for response data\n  const [rows, setRows] = useState<UserInvite[]>([]);\n\n  const projectID = getProjectID();\n\n  // for setting the role of the user while sending invitation\n  const [roles, setRoles] = useState<Role[]>([]);\n\n  // Array to store the list of selected users to be invited\n  const [selected, setSelected] = React.useState<SelectedUser[]>([]);\n\n  // Sets the user role while inviting\n  const setUserRole = (user_uid: string, role: string) => {\n    setSelected(\n      selected.map((r) => (r.user_id === user_uid ? { ...r, role } : r))\n    );\n    if (roles.find((ele) => ele.user_uid === user_uid)) {\n      setRoles(\n        roles.map((r) => (r.user_uid === user_uid ? { user_uid, role } : r))\n      );\n    } else {\n      setRoles([...roles, { user_uid, role }]);\n    }\n  };\n\n  const { loading, data: dataB } = useQuery<ProjectDetail, ProjectDetailVars>(\n    GET_PROJECT,\n    {\n      variables: { projectID },\n      fetchPolicy: 'cache-and-network',\n    }\n  );\n\n  useQuery(ALL_USERS, {\n    skip: !dataB,\n    onCompleted: (data) => {\n      const memberList = new Map();\n      const users: UserInvite[] = [];\n      if (dataB !== undefined) {\n        dataB.getProject.members.forEach((member) => {\n          if (\n            member.invitation === 'Accepted' ||\n            member.invitation === 'Pending'\n          ) {\n            memberList.set(member.user_id, 1);\n          }\n        });\n        // check for displaying only those users who are not the part of team\n        data &&\n          data.users.forEach((user: UserInvite) => {\n            if (!memberList.has(user.id)) users.push(user);\n          });\n        setRows([...users]);\n      }\n    },\n  });\n\n  // mutation to send invitation to selected users\n  const [SendInvite, { error: errorB, loading: loadingB }] =\n    useMutation<MemberInviteNew>(SEND_INVITE, {\n      refetchQueries: [\n        {\n          query: GET_PROJECT,\n          variables: { projectID },\n        },\n      ],\n    });\n\n  // Checks if the user the already selected or not\n  const isSelected = (user: UserInvite) => {\n    const user_uids = new Map();\n    selected.map((el) => user_uids.set(el.user_id, el.role));\n    return user_uids.has(user.id);\n  };\n\n  const handleClick = (\n    event: React.MouseEvent<unknown>,\n    selectedUser: UserInvite\n  ) => {\n    const selectedIds = selected.map((el) => el.user_id);\n    const isUserAlreadySelected = selectedIds.indexOf(selectedUser.id);\n    let newSelected: SelectedUser[] = [];\n    if (isUserAlreadySelected === -1) {\n      const userrole = () => {\n        const r = roles.find((ele) => ele.user_uid === selectedUser.id);\n        if (r) {\n          return r.role;\n        }\n        return 'Viewer';\n      };\n      newSelected = newSelected.concat(selected, {\n        user_name: selectedUser.username,\n        user_id: selectedUser.id,\n        role: userrole(),\n      });\n    } else if (isUserAlreadySelected === 0) {\n      newSelected = newSelected.concat(selected.slice(1));\n    } else if (isUserAlreadySelected === selected.length - 1) {\n      newSelected = newSelected.concat(selected.slice(0, -1));\n    } else if (isUserAlreadySelected > 0) {\n      newSelected = newSelected.concat(\n        selected.slice(0, isUserAlreadySelected),\n        selected.slice(isUserAlreadySelected + 1)\n      );\n    }\n    setSelected(newSelected);\n  };\n\n  // States for filters\n  const [filters, setFilters] = useState<FilterOptions>({\n    search: '',\n  });\n\n  const filteredData = !loading\n    ? rows.filter((dataRow) => {\n        return dataRow.username\n          .toLowerCase()\n          .includes(filters.search.toLowerCase());\n      })\n    : [];\n\n  const [showsuccess, setShowsuccess] = useState<boolean>(false);\n\n  return (\n    <div>\n      {showsuccess ? (\n        <>\n          {loadingB ? (\n            <>\n              <Loader />\n            </>\n          ) : (\n            <Typography>\n              {errorB ? (\n                <Typography>{errorB.message}</Typography>\n              ) : (\n                <div\n                  data-cy=\"inviteNewMemberSuccessModal\"\n                  className={classes.body}\n                >\n                  <img src=\"./icons/checkmark.svg\" alt=\"checkmark\" />\n                  <div className={classes.text}>\n                    <Typography className={classes.typo}>\n                      {t('settings.teamingTab.inviteNew.invite.successHeader')}{' '}\n                      <strong>\n                        {t(\n                          'settings.teamingTab.inviteNew.invite.successHeaderStrong'\n                        )}\n                      </strong>\n                    </Typography>\n                  </div>\n                  <div className={classes.textSecond}>\n                    <Typography className={classes.typoSub}>\n                      {t('settings.teamingTab.inviteNew.invite.info')}\n                    </Typography>\n                  </div>\n                  <div\n                    data-cy=\"inviteNewMemberSuccessModalDoneButton\"\n                    className={classes.buttonModal}\n                  >\n                    <ButtonFilled onClick={handleModal}>\n                      <>\n                        {t('settings.teamingTab.inviteNew.invite.button.done')}\n                      </>\n                    </ButtonFilled>\n                  </div>\n                </div>\n              )}\n            </Typography>\n          )}\n        </>\n      ) : (\n        <div>\n          <Typography className={classes.Header}>\n            {t('settings.teamingTab.inviteNew.invite.header')}{' '}\n            <strong>\n              {t('settings.teamingTab.inviteNew.invite.headerStrong')}\n            </strong>\n          </Typography>\n          <Toolbar className={classes.toolbar}>\n            <div\n              data-cy=\"inviteNewMemberSearch\"\n              className={classes.inviteSomeone}\n            >\n              <div>\n                <Input\n                  id=\"input-with-icon-textfield\"\n                  placeholder={t(\n                    'settings.teamingTab.inviteNew.invite.label.someone'\n                  )}\n                  onChange={(e) => {\n                    setFilters({\n                      search: e.target.value,\n                    });\n                  }}\n                  startAdornment={\n                    <InputAdornment position=\"start\">\n                      <img src=\"./icons/user-invite.svg\" alt=\"user\" />\n                    </InputAdornment>\n                  }\n                  disableUnderline\n                  inputProps={{\n                    className: classes.input,\n                    style: {\n                      color: theme.palette.text.primary,\n                    },\n                  }}\n                />\n              </div>\n              <div data-cy=\"inviteNewMemberSendInviteButton\">\n                <ButtonFilled\n                  disabled={!selected.length}\n                  onClick={() => {\n                    setShowsuccess(true);\n                    selected.map(\n                      (s) =>\n                        !errorB &&\n                        !loadingB &&\n                        SendInvite({\n                          variables: {\n                            member: {\n                              project_id: projectID,\n                              user_id: s.user_id,\n                              role: s.role,\n                            },\n                          },\n                        })\n                    );\n                  }}\n                >\n                  <div>\n                    {t('settings.teamingTab.inviteNew.invite.button.send')}\n                  </div>\n                </ButtonFilled>\n              </div>\n            </div>\n          </Toolbar>\n          <TableContainer\n            data-cy=\"inviteNewMemberTable\"\n            className={classes.table}\n          >\n            <Table stickyHeader aria-label=\"sticky table\">\n              {filteredData && filteredData.length > 0 ? (\n                filteredData.map((row, index) => {\n                  const isItemSelected = isSelected(row);\n                  const labelId = `enhanced-table-checkbox-${index}`;\n\n                  return (\n                    <TableRow\n                      data-cy=\"inviteNewMemberCheckBox\"\n                      role=\"checkbox\"\n                      key={row.id}\n                      aria-checked={isItemSelected}\n                      selected={isItemSelected}\n                    >\n                      <TableData\n                        row={row}\n                        isItemSelected={isItemSelected}\n                        handleCheck={handleClick}\n                        labelId={labelId}\n                        sendInvite={setUserRole}\n                      />\n                    </TableRow>\n                  );\n                })\n              ) : (\n                <TableRow>\n                  <TableCell colSpan={2} className={classes.tableCell}>\n                    <Typography align=\"center\">\n                      {t('settings.teamingTab.inviteNew.invite.noUsers')}\n                    </Typography>\n                  </TableCell>\n                </TableRow>\n              )}\n            </Table>\n          </TableContainer>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Invite;\n"]},"metadata":{},"sourceType":"module"}