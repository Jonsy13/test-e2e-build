{"ast":null,"code":"import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useMutation}from'@apollo/client';import{Typography}from'@material-ui/core';import{ButtonFilled,ButtonOutlined,Modal}from'litmus-ui';import React,{useState}from'react';import{useTranslation}from'react-i18next';import Loader from'../../../../../components/Loader';import config from'../../../../../config';import{CREATE_USER}from'../../../../../graphql';import{getToken}from'../../../../../utils/auth';import useStyles from'./styles';// Props for NewUserModal component\n// NewUserModal displays a modal on creating a new user\nvar NewUserModal=function NewUserModal(_ref){var username=_ref.username,password=_ref.password,name=_ref.name,email=_ref.email,handleDiv=_ref.handleDiv;var classes=useStyles();var _useTranslation=useTranslation(),t=_useTranslation.t;var role='user';var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),open=_React$useState2[0],setOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),loading=_React$useState4[0],setLoading=_React$useState4[1];var _useState=useState(''),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var handleClose=function handleClose(){setOpen(false);handleDiv();};var _useMutation=useMutation(CREATE_USER,{onError:function onError(err){console.error(err);},onCompleted:function onCompleted(){setLoading(false);setOpen(true);setError('');}}),_useMutation2=_slicedToArray(_useMutation,1),CreateUser=_useMutation2[0];var handleOpen=function handleOpen(){setLoading(true);fetch(\"\".concat(config.auth.url,\"/create\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(getToken())},body:JSON.stringify({email:email,username:username,name:name,password:password,role:role})}).then(function(response){return response.json();}).then(function(data){if('error'in data){setError(data.error_description);setLoading(false);setOpen(true);}else{CreateUser({variables:{user:{username:username,email:email,name:name,role:'user',userID:data._id}}});}}).catch(function(err){console.error(err);setError(err.message);setLoading(false);setOpen(true);});};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"createNewUserButton\"},/*#__PURE__*/React.createElement(ButtonFilled,{disabled:!(username.length>0&&password.length>0&&!loading),onClick:handleOpen},loading?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Loader,{size:20})):/*#__PURE__*/React.createElement(React.Fragment,null,t('settings.userManagementTab.createUser.newUserModal.button.create')))),/*#__PURE__*/React.createElement(Modal,{open:open,onClose:handleClose,modalActions:/*#__PURE__*/React.createElement(ButtonOutlined,{onClick:handleClose},\"\\u2715\")},error.length?/*#__PURE__*/React.createElement(\"div\",{className:classes.errDiv},/*#__PURE__*/React.createElement(\"div\",{className:classes.textError},/*#__PURE__*/React.createElement(Typography,{className:classes.typo,align:\"center\"},/*#__PURE__*/React.createElement(\"strong\",null,t('settings.userManagementTab.createUser.newUserModal.error')),' ',t('settings.userManagementTab.createUser.newUserModal.headerErr'))),/*#__PURE__*/React.createElement(\"div\",{className:classes.textSecondError},/*#__PURE__*/React.createElement(Typography,{className:classes.typoSub},t('settings.userManagementTab.createUser.newUserModal.error'),\":\",' ',error)),/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"newUserDoneButton\",className:classes.buttonModal},/*#__PURE__*/React.createElement(ButtonFilled,{onClick:handleClose},/*#__PURE__*/React.createElement(React.Fragment,null,t('settings.userManagementTab.createUser.newUserModal.button.done'))))):/*#__PURE__*/React.createElement(\"div\",{className:classes.body},/*#__PURE__*/React.createElement(\"img\",{src:\"./icons/checkmark.svg\",alt:\"checkmark\"}),/*#__PURE__*/React.createElement(\"div\",{className:classes.text},/*#__PURE__*/React.createElement(Typography,{className:classes.typo,align:\"center\"},t('settings.userManagementTab.createUser.newUserModal.header'),' ',/*#__PURE__*/React.createElement(\"strong\",null,name),' ',t('settings.userManagementTab.createUser.newUserModal.headerInfo'))),/*#__PURE__*/React.createElement(\"div\",{className:classes.textSecond},/*#__PURE__*/React.createElement(Typography,{className:classes.typoSub},t('settings.userManagementTab.createUser.newUserModal.info'))),/*#__PURE__*/React.createElement(\"div\",{\"data-cy\":\"newUserDoneButton\",className:classes.buttonModal},/*#__PURE__*/React.createElement(ButtonFilled,{onClick:handleClose},/*#__PURE__*/React.createElement(React.Fragment,null,t('settings.userManagementTab.createUser.newUserModal.button.done')))))));};export default NewUserModal;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/Settings/UserManagementTab/CreateUser/NewUserModal/index.tsx"],"names":["useMutation","Typography","ButtonFilled","ButtonOutlined","Modal","React","useState","useTranslation","Loader","config","CREATE_USER","getToken","useStyles","NewUserModal","username","password","name","email","handleDiv","classes","t","role","open","setOpen","loading","setLoading","error","setError","handleClose","onError","err","console","onCompleted","CreateUser","handleOpen","fetch","auth","url","method","headers","Authorization","body","JSON","stringify","then","response","json","data","error_description","variables","user","userID","_id","catch","message","length","errDiv","textError","typo","textSecondError","typoSub","buttonModal","text","textSecond"],"mappings":"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","sourcesContent":["import { useMutation } from '@apollo/client';\nimport { Typography } from '@material-ui/core';\nimport { ButtonFilled, ButtonOutlined, Modal } from 'litmus-ui';\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Loader from '../../../../../components/Loader';\nimport config from '../../../../../config';\nimport { CREATE_USER } from '../../../../../graphql';\nimport { CreateUserData } from '../../../../../models/graphql/user';\nimport { getToken } from '../../../../../utils/auth';\nimport useStyles from './styles';\n\n// Props for NewUserModal component\ninterface NewUserModalProps {\n  showModal: boolean;\n  username: string;\n  password: string;\n  name: string;\n  email: string;\n  handleDiv: () => void;\n}\n\n// NewUserModal displays a modal on creating a new user\nconst NewUserModal: React.FC<NewUserModalProps> = ({\n  username,\n  password,\n  name,\n  email,\n  handleDiv,\n}) => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n  const role = 'user';\n  const [open, setOpen] = React.useState(false);\n  const [loading, setLoading] = React.useState(false);\n  const [error, setError] = useState<string>('');\n\n  const handleClose = () => {\n    setOpen(false);\n    handleDiv();\n  };\n\n  const [CreateUser] = useMutation<CreateUserData>(CREATE_USER, {\n    onError: (err) => {\n      console.error(err);\n    },\n    onCompleted: () => {\n      setLoading(false);\n      setOpen(true);\n      setError('');\n    },\n  });\n\n  const handleOpen = () => {\n    setLoading(true);\n    fetch(`${config.auth.url}/create`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${getToken()}`,\n      },\n      body: JSON.stringify({ email, username, name, password, role }),\n    })\n      .then((response) => {\n        return response.json();\n      })\n      .then((data) => {\n        if ('error' in data) {\n          setError(data.error_description as string);\n          setLoading(false);\n          setOpen(true);\n        } else {\n          CreateUser({\n            variables: {\n              user: {\n                username,\n                email,\n                name,\n                role: 'user',\n                userID: data._id,\n              },\n            },\n          });\n        }\n      })\n      .catch((err) => {\n        console.error(err);\n        setError(err.message as string);\n        setLoading(false);\n        setOpen(true);\n      });\n  };\n\n  return (\n    <div>\n      <div data-cy=\"createNewUserButton\">\n        <ButtonFilled\n          disabled={!(username.length > 0 && password.length > 0 && !loading)}\n          onClick={handleOpen}\n        >\n          {loading ? (\n            <div>\n              <Loader size={20} />\n            </div>\n          ) : (\n            <>\n              {t(\n                'settings.userManagementTab.createUser.newUserModal.button.create'\n              )}\n            </>\n          )}\n        </ButtonFilled>\n      </div>\n      <Modal\n        open={open}\n        onClose={handleClose}\n        modalActions={\n          <ButtonOutlined onClick={handleClose}>&#x2715;</ButtonOutlined>\n        }\n      >\n        {error.length ? (\n          <div className={classes.errDiv}>\n            {/* <img src=\"./icons/checkmark.svg\" alt=\"checkmark\" /> */}\n\n            <div className={classes.textError}>\n              <Typography className={classes.typo} align=\"center\">\n                <strong>\n                  {t(\n                    'settings.userManagementTab.createUser.newUserModal.error'\n                  )}\n                </strong>{' '}\n                {t(\n                  'settings.userManagementTab.createUser.newUserModal.headerErr'\n                )}\n              </Typography>\n            </div>\n            <div className={classes.textSecondError}>\n              <Typography className={classes.typoSub}>\n                {t('settings.userManagementTab.createUser.newUserModal.error')}:{' '}\n                {error}\n              </Typography>\n            </div>\n            <div data-cy=\"newUserDoneButton\" className={classes.buttonModal}>\n              <ButtonFilled onClick={handleClose}>\n                <>\n                  {t(\n                    'settings.userManagementTab.createUser.newUserModal.button.done'\n                  )}\n                </>\n              </ButtonFilled>\n            </div>\n          </div>\n        ) : (\n          <div className={classes.body}>\n            <img src=\"./icons/checkmark.svg\" alt=\"checkmark\" />\n            <div className={classes.text}>\n              <Typography className={classes.typo} align=\"center\">\n                {t('settings.userManagementTab.createUser.newUserModal.header')}{' '}\n                <strong>{name}</strong>{' '}\n                {t(\n                  'settings.userManagementTab.createUser.newUserModal.headerInfo'\n                )}\n              </Typography>\n            </div>\n            <div className={classes.textSecond}>\n              <Typography className={classes.typoSub}>\n                {t('settings.userManagementTab.createUser.newUserModal.info')}\n              </Typography>\n            </div>\n            <div data-cy=\"newUserDoneButton\" className={classes.buttonModal}>\n              <ButtonFilled onClick={handleClose}>\n                <>\n                  {t(\n                    'settings.userManagementTab.createUser.newUserModal.button.done'\n                  )}\n                </>\n              </ButtonFilled>\n            </div>\n          </div>\n        )}\n      </Modal>\n    </div>\n  );\n};\nexport default NewUserModal;\n"]},"metadata":{},"sourceType":"module"}