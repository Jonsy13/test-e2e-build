{"ast":null,"code":"import _slicedToArray from\"/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useMutation,useQuery}from'@apollo/client';import{AccordionDetails,IconButton,RadioGroup,Typography,useTheme}from'@material-ui/core';import{LitmusCard,RadioButton,Search}from'litmus-ui';import localforage from'localforage';import React,{useEffect,useState}from'react';import{useTranslation}from'react-i18next';import{DELETE_WORKFLOW_TEMPLATE,LIST_MANIFEST_TEMPLATE}from'../../../graphql';import{getProjectID}from'../../../utils/getSearchParams';import*as WorkflowActions from'../../../redux/actions/workflow';import useStyles from'./styles';import useActions from'../../../redux/actions';var ChooseWorkflowFromExisting=function ChooseWorkflowFromExisting(){var _useTranslation=useTranslation(),t=_useTranslation.t;var classes=useStyles();var _useTheme=useTheme(),palette=_useTheme.palette;// Local States\nvar _useState=useState(null),_useState2=_slicedToArray(_useState,2),search=_useState2[0],setSearch=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),selected=_useState4[0],setSelected=_useState4[1];var workflowAction=useActions(WorkflowActions);var _useQuery=useQuery(LIST_MANIFEST_TEMPLATE,{variables:{data:getProjectID()},fetchPolicy:'network-only'}),templateData=_useQuery.data;var _useMutation=useMutation(DELETE_WORKFLOW_TEMPLATE,{refetchQueries:[{query:LIST_MANIFEST_TEMPLATE,variables:{data:getProjectID()}}]}),_useMutation2=_slicedToArray(_useMutation,1),deleteTemplate=_useMutation2[0];var filteredExistingWorkflows=templateData?templateData.ListManifestTemplate.filter(function(w){if(search===null)return w;if(w.template_name.toLowerCase().includes(search.toLowerCase()))return w;return null;}):[];// Methods\nvar handleChange=function handleChange(event){setSelected(event.target.value);var selection={selected:'B',id:event.target.value};var templateData=filteredExistingWorkflows.filter(function(workflow){return workflow.template_id===event.target.value;})[0];workflowAction.setWorkflowManifest({isCustomWorkflow:templateData.isCustomWorkflow});localforage.setItem('selectedScheduleOption',selection);localforage.setItem('workflow',{name:templateData.template_name.toLowerCase(),description:templateData.template_description,icon:'./avatars/litmus.svg',CRDLink:templateData.template_id});localforage.setItem('hasSetWorkflowData',true);};// Selects Option B -> Sub Experiment Options which was already selected by the user\nuseEffect(function(){localforage.getItem('selectedScheduleOption').then(function(value){return value!==null?setSelected(value.id):setSelected('');});},[]);return/*#__PURE__*/React.createElement(AccordionDetails,null,/*#__PURE__*/React.createElement(\"div\",{style:{width:'100%'}},/*#__PURE__*/React.createElement(Search,{\"data-cy\":\"agentSearch\",id:\"input-with-icon-textfield\",placeholder:\"Search\",value:search,onChange:function onChange(event){return setSearch(event.target.value);}}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{className:classes.predefinedWorkflowDiv},/*#__PURE__*/React.createElement(RadioGroup,{\"data-cy\":\"templateWorkflowsRadioGroup\",value:selected,onChange:handleChange},filteredExistingWorkflows&&filteredExistingWorkflows.length?filteredExistingWorkflows.map(function(templateData){return/*#__PURE__*/React.createElement(LitmusCard,{width:\"100%\",height:\"5rem\",key:templateData.template_id,borderColor:palette.border.main,className:classes.existingWorkflowCard},/*#__PURE__*/React.createElement(RadioButton,{value:templateData.template_id.toString()},/*#__PURE__*/React.createElement(\"div\",{id:\"body\"},/*#__PURE__*/React.createElement(\"div\",{id:\"left-div\"},/*#__PURE__*/React.createElement(Typography,null,templateData.template_name)),/*#__PURE__*/React.createElement(\"div\",{id:\"right-div\"},/*#__PURE__*/React.createElement(Typography,null,templateData.template_description)),/*#__PURE__*/React.createElement(\"div\",{id:\"last-div\"},/*#__PURE__*/React.createElement(\"div\",{className:classes.lastDivChildren},/*#__PURE__*/React.createElement(\"img\",{src:\"./icons/litmus-icon.svg\",alt:\"Experiment Icon\"}),/*#__PURE__*/React.createElement(Typography,null,templateData.project_name)),/*#__PURE__*/React.createElement(\"img\",{src:\"./icons/templateIcon.svg\",alt:\"template\",className:classes.templateIconBg})),/*#__PURE__*/React.createElement(IconButton,{onClick:function onClick(){deleteTemplate({variables:{data:templateData.template_id}});}},/*#__PURE__*/React.createElement(\"img\",{alt:\"delete\",src:\"./icons/deleteBox.svg\",height:\"30\"})))));}):/*#__PURE__*/React.createElement(\"div\",{className:classes.noTemplatesDiv},/*#__PURE__*/React.createElement(Typography,{className:classes.noTemplatesText},/*#__PURE__*/React.createElement(\"strong\",null,t('createWorkflow.chooseWorkflow.noTemplates'))),/*#__PURE__*/React.createElement(Typography,{className:classes.noTemplatesDesc},t('createWorkflow.chooseWorkflow.addTemplate'))))),/*#__PURE__*/React.createElement(\"div\",{className:classes.blur})));};export default ChooseWorkflowFromExisting;","map":{"version":3,"sources":["/home/vedant/go/src/github.com/litmus/litmus-portal/frontend/src/views/CreateWorkflow/ChooseWorkflow/ChooseWorkflowFromExisting.tsx"],"names":["useMutation","useQuery","AccordionDetails","IconButton","RadioGroup","Typography","useTheme","LitmusCard","RadioButton","Search","localforage","React","useEffect","useState","useTranslation","DELETE_WORKFLOW_TEMPLATE","LIST_MANIFEST_TEMPLATE","getProjectID","WorkflowActions","useStyles","useActions","ChooseWorkflowFromExisting","t","classes","palette","search","setSearch","selected","setSelected","workflowAction","variables","data","fetchPolicy","templateData","refetchQueries","query","deleteTemplate","filteredExistingWorkflows","ListManifestTemplate","filter","w","template_name","toLowerCase","includes","handleChange","event","target","value","selection","id","workflow","template_id","setWorkflowManifest","isCustomWorkflow","setItem","name","description","template_description","icon","CRDLink","getItem","then","width","predefinedWorkflowDiv","length","map","border","main","existingWorkflowCard","toString","lastDivChildren","project_name","templateIconBg","noTemplatesDiv","noTemplatesText","noTemplatesDesc","blur"],"mappings":"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","sourcesContent":["import { useMutation, useQuery } from '@apollo/client';\nimport {\n  AccordionDetails,\n  IconButton,\n  RadioGroup,\n  Typography,\n  useTheme,\n} from '@material-ui/core';\nimport { LitmusCard, RadioButton, Search } from 'litmus-ui';\nimport localforage from 'localforage';\nimport React, { useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport {\n  DELETE_WORKFLOW_TEMPLATE,\n  LIST_MANIFEST_TEMPLATE,\n} from '../../../graphql';\nimport {\n  ListManifestTemplate,\n  ListManifestTemplateArray,\n} from '../../../models/graphql/workflowListData';\nimport { getProjectID } from '../../../utils/getSearchParams';\nimport * as WorkflowActions from '../../../redux/actions/workflow';\nimport useStyles from './styles';\nimport useActions from '../../../redux/actions';\n\ninterface ChooseWorkflowRadio {\n  selected: string;\n  id: string;\n}\n\nconst ChooseWorkflowFromExisting = () => {\n  const { t } = useTranslation();\n  const classes = useStyles();\n  const { palette } = useTheme();\n  // Local States\n  const [search, setSearch] = useState<string | null>(null);\n  const [selected, setSelected] = useState<string>('');\n  const workflowAction = useActions(WorkflowActions);\n  const { data: templateData } = useQuery<ListManifestTemplate>(\n    LIST_MANIFEST_TEMPLATE,\n    {\n      variables: {\n        data: getProjectID(),\n      },\n      fetchPolicy: 'network-only',\n    }\n  );\n\n  const [deleteTemplate] = useMutation(DELETE_WORKFLOW_TEMPLATE, {\n    refetchQueries: [\n      {\n        query: LIST_MANIFEST_TEMPLATE,\n        variables: { data: getProjectID() },\n      },\n    ],\n  });\n\n  const filteredExistingWorkflows: ListManifestTemplateArray[] = templateData\n    ? templateData.ListManifestTemplate.filter(\n        (w: ListManifestTemplateArray) => {\n          if (search === null) return w;\n          if (w.template_name.toLowerCase().includes(search.toLowerCase()))\n            return w;\n          return null;\n        }\n      )\n    : [];\n\n  // Methods\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setSelected(event.target.value);\n    const selection: ChooseWorkflowRadio = {\n      selected: 'B',\n      id: event.target.value,\n    };\n    const templateData = filteredExistingWorkflows.filter((workflow) => {\n      return workflow.template_id === event.target.value;\n    })[0];\n    workflowAction.setWorkflowManifest({\n      isCustomWorkflow: templateData.isCustomWorkflow,\n    });\n    localforage.setItem('selectedScheduleOption', selection);\n    localforage.setItem('workflow', {\n      name: templateData.template_name.toLowerCase(),\n      description: templateData.template_description,\n      icon: './avatars/litmus.svg',\n      CRDLink: templateData.template_id,\n    });\n    localforage.setItem('hasSetWorkflowData', true);\n  };\n\n  // Selects Option B -> Sub Experiment Options which was already selected by the user\n  useEffect(() => {\n    localforage\n      .getItem('selectedScheduleOption')\n      .then((value) =>\n        value !== null\n          ? setSelected((value as ChooseWorkflowRadio).id)\n          : setSelected('')\n      );\n  }, []);\n\n  return (\n    <AccordionDetails>\n      {/* Wrapping content inside the Accordion to take full width */}\n      <div style={{ width: '100%' }}>\n        <Search\n          data-cy=\"agentSearch\"\n          id=\"input-with-icon-textfield\"\n          placeholder=\"Search\"\n          value={search}\n          onChange={(event) => setSearch(event.target.value)}\n        />\n\n        {/* Leaving some space between the search and workflow cards */}\n        <br />\n        <br />\n\n        <div className={classes.predefinedWorkflowDiv}>\n          <RadioGroup\n            data-cy=\"templateWorkflowsRadioGroup\"\n            value={selected}\n            onChange={handleChange}\n          >\n            {filteredExistingWorkflows && filteredExistingWorkflows.length ? (\n              filteredExistingWorkflows.map(\n                (templateData: ListManifestTemplateArray) => (\n                  <LitmusCard\n                    width=\"100%\"\n                    height=\"5rem\"\n                    key={templateData.template_id}\n                    borderColor={palette.border.main}\n                    className={classes.existingWorkflowCard}\n                  >\n                    <RadioButton value={templateData.template_id.toString()}>\n                      <div id=\"body\">\n                        <div id=\"left-div\">\n                          <Typography>{templateData.template_name}</Typography>\n                        </div>\n                        <div id=\"right-div\">\n                          <Typography>\n                            {templateData.template_description}\n                          </Typography>\n                        </div>\n                        <div id=\"last-div\">\n                          <div className={classes.lastDivChildren}>\n                            <img\n                              src=\"./icons/litmus-icon.svg\"\n                              alt=\"Experiment Icon\"\n                            />\n                            <Typography>{templateData.project_name}</Typography>\n                          </div>\n\n                          <img\n                            src=\"./icons/templateIcon.svg\"\n                            alt=\"template\"\n                            className={classes.templateIconBg}\n                          />\n                        </div>\n                        <IconButton\n                          onClick={() => {\n                            deleteTemplate({\n                              variables: { data: templateData.template_id },\n                            });\n                          }}\n                        >\n                          <img\n                            alt=\"delete\"\n                            src=\"./icons/deleteBox.svg\"\n                            height=\"30\"\n                          />\n                        </IconButton>\n                      </div>\n                    </RadioButton>\n                  </LitmusCard>\n                )\n              )\n            ) : (\n              <div className={classes.noTemplatesDiv}>\n                <Typography className={classes.noTemplatesText}>\n                  <strong>\n                    {t('createWorkflow.chooseWorkflow.noTemplates')}\n                  </strong>\n                </Typography>\n                <Typography className={classes.noTemplatesDesc}>\n                  {t('createWorkflow.chooseWorkflow.addTemplate')}\n                </Typography>\n              </div>\n            )}\n          </RadioGroup>\n        </div>\n        {/* Bottom Blur */}\n        <div className={classes.blur} />\n      </div>\n    </AccordionDetails>\n  );\n};\nexport default ChooseWorkflowFromExisting;\n"]},"metadata":{},"sourceType":"module"}